<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="content-type" content="text/html;charset=UTF-8" />
	<meta charset="utf-8" />
	<title>List of Awesome - My Lists</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<link rel="apple-touch-icon" href="/assets/img/favicon/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicon/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicon/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicon/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicon/favicon-16x16.png">
	<link rel="icon" type="image/x-icon" href="/assets/img/favicon/favicon.ico" />
	<link rel="manifest" href="/assets/img/favicon/site.webmanifest">
	<meta name="msapplication-TileColor" content="#da532c">
	<meta name="theme-color" content="#ffffff">

	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-touch-fullscreen" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="default">
	<meta content="" name="description" />
	<meta content="Luke Vink" name="author" />

	<link href="../assets/plugins/pace/pace-theme-flash.css" rel="stylesheet" type="text/css">
	<link href="../assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
	<link href="../assets/plugins/font-awesome-5/css/all.css" rel="stylesheet" type="text/css">
	<link href="../assets/plugins/jquery-scrollbar/jquery.scrollbar.css" media="screen" rel="stylesheet" type="text/css">
	<link href="../assets/plugins/select2/css/select2.min.css" media="screen" rel="stylesheet" type="text/css">
	<link href="../assets/plugins/datatables/DataTables-1.10.24/css/jquery.dataTables.min.css" rel="stylesheet" type="text/css">
	<link href="../assets/plugins/datatables/Responsive-2.2.7/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
	<link href="../assets/plugins/swiper6.4.15/swiper-bundle.min.css" rel="stylesheet">
	<link class="main-stylesheet" href="../pages/css/themes/achtung.css" rel="stylesheet" type="text/css">
	<link class="main-stylesheet" href="../assets/css/style.css" rel="stylesheet" type="text/css">


	<script defer="" src="/__/firebase/8.2.9/firebase-app.js"></script>
	<script defer="" src="/__/firebase/8.2.9/firebase-auth.js"></script>
	<script defer="" src="/__/firebase/8.2.9/firebase-firestore.js"></script>
	<script defer="" src="/__/firebase/8.2.9/firebase-storage.js"></script>
	<script defer="" src="/__/firebase/8.2.9/firebase-analytics.js"></script>
	<script defer="" src="/__/firebase/8.2.9/firebase-remote-config.js"></script>
	<script defer="" src="/__/firebase/8.2.9/firebase-performance.js"></script>
	<!--
		initialize the SDK after all desired features are loaded, set useEmulator to false
		to avoid connecting the SDK to running emulators.
	-->
	<script defer="" src="/__/firebase/init.js?useEmulator=true"></script>


</head>

<body class="fixed-header menu-pin menu-behind">
	<!-- BEGIN SIDEBAR -->
	    <!-- BEGIN SIDEBPANEL-->
    <nav class="page-sidebar" data-pages="sidebar">
      <!-- BEGIN SIDEBAR MENU TOP TRAY CONTENT-->
      <div class="sidebar-overlay-slide from-top" id="appMenu">
      </div>
      <!-- END SIDEBAR MENU TOP TRAY CONTENT-->
      <!-- BEGIN SIDEBAR MENU HEADER-->
      <div class="sidebar-header">
      </div>
      <!-- END SIDEBAR MENU HEADER-->
      <!-- START SIDEBAR MENU -->
      <div class="sidebar-menu">
        <!-- BEGIN SIDEBAR MENU ITEMS-->
        <ul class="menu-items">
	        <li class="m-t-30" >
            <a href="../">
              <span class="title">All People</span>
              <span class=" arrow"></span>
            </a>
            <span class="icon-thumbnail"><i class="pg-icon">users</i></span>
            <ul class="sub-menu">
              <li class="active">
                <a href="#">List</a>
                <span class="icon-thumbnail"><i class="pg-icon">list_bullets</i></span>
              </li>
              <li class="">
                <a href="#">Grid</a>
                <span class="icon-thumbnail"><i class="pg-icon">grid</i></span>
              </li>
          	</ul>
          </li>
					<li class="">
            <a href="../review">
              <span class="title">Needs Review</span>
            </a>
            <span class="icon-thumbnail "><i id="menu-review-icon" class="pg-icon">star</i></span>
          </li>
          <li class="">
            <a href="../add">
              <span class="title">Add Person</span>
            </a>
            <span class="icon-thumbnail "><i class="pg-icon">user_add</i></span>
          </li>
					<li class="active">
						<a href="../lists">
							<span class="title">My Lists</span>
						</a>
						<span class="icon-thumbnail "><i class="pg-icon">pin</i></span>
					</li>
					<li class="">
            <a href="../settings">
              <span class="title">Settings</span>
            </a>
            <span class="icon-thumbnail "><i class="pg-icon">cog</i></span>
          </li>
        </ul>
        <div class="clearfix"></div>
      </div>
      <!-- END SIDEBAR MENU -->
    </nav>
    <!-- END SIDEBAR -->
	<!-- END SIDEBAR -->
	<!-- START PAGE-CONTAINER -->
	<div class="page-container">
		<div id="sidebar-modal-shade" class="filter-modal-shade"></div>
		<!-- START PAGE HEADER WRAPPER -->
		<!-- START HEADER -->
		<div class="header ">
			<!-- START MOBILE SIDEBAR TOGGLE -->
				<a href="#" class="btn-link toggle-sidebar d-lg-none pg-icon btn-icon-link" data-toggle="sidebar">menu</a>
			<!-- END MOBILE SIDEBAR TOGGLE -->
			<div class="">
				<div class="brand inline  m-l-10 ">
					<img src="../assets/img/logo.png" alt="logo" data-src="../assets/img/logo.png" data-src-retina="../assets/img/logo.png" height="45">
				</div>

<!-- 				<a href="#" class="search-link d-lg-inline-block d-none" style="margin-left:50px;" data-toggle="search"><i class="pg-icon">search</i>Type anywhere to <span class="bold">search</span></a> -->
			</div>
			<div class="d-flex align-items-center">

				<!-- START User Info-->
				<div class="dropdown pull-right d-lg-block">
					<button class="profile-dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true"
						aria-expanded="false" aria-label="profile dropdown">
						<span class="thumbnail-wrapper d32 circular inline">
							<img id="account-photo" src="../assets/img/profiles/0.png"  width="32" height="32">
						</span>
					</button>
					<div class="dropdown-menu dropdown-menu-right profile-dropdown" role="menu">
						<a href="#" class="dropdown-item"><span>Signed in as <br /><b><span id="account-name">Achtung!<span></b></span></a>
						<div class="dropdown-divider"></div>
						<a class="dropdown-item">Settings</a>
						<a id="sign-out" class="dropdown-item">Sign Out</a>
					</div>
				</div>
				<!-- END User Info-->

			</div>
		</div>
		<!-- END HEADER -->
		<!-- END PAGE HEADER WRAPPER -->
		<!-- START PAGE CONTENT WRAPPER -->
		<div class="page-content-wrapper">
			<!-- START PAGE CONTENT -->
			<div class="content">

				<!-- START CONTAINER FLUID -->
				<div class="container-fluid container-fixed-lg">
					<!-- BEGIN PlACE PAGE CONTENT HERE -->


					<div class="row d-flex" style="margin-top:24px; margin-bottom:25px;">
						<div class="col-3 col-xl-3 col-lg-3">
							<h4>My Lists</h4>
						</div>
						<div class="col-9 col-xl-9 col-lg-9" style="text-align:right">
							<button id="delete-modal" data-toggle="modal" data-target="#modalDeleteList"  class="btn btn-huge just-icon"><span class="icon-thumbnail "><i class="pg-icon">trash_alt</i></span></button	>
							<button id="download-list"  class="btn btn-huge "><span class="icon-thumbnail "><i class="pg-icon">download</i></span>Download List</button	>
							<!-- <button id="add-row"  class="btn btn-primary btn-huge "><span class="icon-thumbnail "><i class="pg-icon">plus</i></span>New List</button	> -->
						</div>
					</div>

					<!-- BEGIN ADD PERSON ROW  -->
					<div class="row d-flex">
						<div class="col-xl-12 col-lg-12">


								<div class="card card-default">

									<div class="card-block">

										<div class="row">
											<div class="col-sm-12 d-md-none d-md-none lists-column">
												<div class="wide-select-wrapper">
													<select class="cs-select cs-skin-slide full-width" id="mobile-list-select">

													</select>
												</div>
											</div>
											<div class="col-md-4 col-lg-3 d-sm-none d-none d-md-block lists-column">
												<div style="min-height:80vh; background:#FcFcFc; border-right: 1px solid #eeeeee;	">
													<ul id="lists-ul">
													</ul>
												</div>
											</div>
											<div id="selected-list-column" class="col-12 col-md-8 col-lg-9">
												<div class="list-wrapper">
													<div id="new-person" class="new-person">
														<p><i class="pg-icon">add</i><b>Add person to list</b></p>
													</div>

													<!-- <div class="search-wrapper">
														<input class="form-control pull-right" id="search-table-full" placeholder="Search" type="text">
													</div> -->

													<!-- BEGIN TABLE -->
													<div class="hideMe" id="contactTableWrapper">
														<table cellspacing="0" class="table table-hover" id="contactsTable" width="100%">
															<thead>
																<tr>
												            <th>Name</th>
												            <th>Position</th>
												            <th>Location</th>
												            <th>Email</th>
												            <th>Skills</th>
																		<th>Worked On</th>
																		<th>Rate</th>
																		<th class="no-sort">links</th>
												            <th class="no-sort"></th>
												        </tr>
															</thead>


															<tbody>
															</tbody>
														</table>
													</div>
													<!-- END TABLE -->

												</div>
												<!-- END LIST WRAPPER -->
											</div>

										</div>


									</div>


								</div>
							</div>

						</div>
					</div>




					<!-- END CONTAINER FLUID -->
				</div>
				<!-- END PAGE CONTENT -->

		</div>
		<!-- END PAGE CONTENT WRAPPER -->
	</div>
	<!-- END PAGE CONTAINER -->


	<!-- DELETE LIST CHECK -->
	<div class="modal fade slide-up disable-scroll" id="modalDeleteList" tabindex="-1" role="dialog" aria-labelledby="modalSlideUpLabel" aria-hidden="false">
			<div class="modal-dialog ">
					<div class="modal-content-wrapper">
					<div class="modal-content">
							<div class="modal-header clearfix text-left">
									<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
										<i class="pg-close fs-14"></i>
									</button>
									<h5 style="width: 100%; text-align:center">Are you sure you want to delete this list?</h5>
							</div>
							<div class="modal-body">

										<div class="row m-t-10 sm-m-t-10">
											<div class="col-md-6">
												<button aria-label="" id="delete-cancel" type="button" class="btn btn-default btn-block m-t-5">Cancel</button>
											</div>
											<div class="col-md-6">
												<button aria-label="" id="delete-list" type="button" class="btn btn-primary btn-block m-t-5">Delete</button>
											</div>
										</div>

									</form>
							</div>
					</div>
					</div>
					<!-- /.modal-content -->
			</div>
	</div>
	<!-- END ADD TO LIST MODAL -->


		<!-- CONTACT MODAL -->
		<div class="modal fade slide-up" id="modalContactView" tabindex="-1" role="dialog" aria-labelledby="modalSlideUpLabel" aria-hidden="false">
		    <div class="modal-dialog modal-lg">
		        <div class="modal-content-wrapper ">
		        <div class="modal-content" id="modalContent">
							<div class="row" style="width:100%; margin:0;">
								<div class="col-md-6 no-padding" id="workColumn">
									<div id="workSwiper" class="swiper-container">
										 <div class="swiper-wrapper"></div>
										 <div class="swiper-pagination"></div>
									</div>
								</div>
								<div class="col-md-6" id="infoColumn">
									<div class="modal-header clearfix text-left"  style="margin-bottom:30px;">
									  <button aria-label="" type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="pg-icon">close</i></button>
										<div class="container" style="padding:0!important">
											<div class="row no-gutters" >
												<div class="col-9">
										      <h3><span id="modal-info-name" class="semi-bold" >John Smith</span></h3>
													<h6><i class="pg-icon" style="vertical-align: bottom; margin-right:10px;">user</i><span id="modal-info-position">Accountant</span></h6>
													<h6><i class="pg-icon" style="vertical-align: bottom; margin-right:10px;">map</i><span id="modal-info-location">Accountant</span></h6>

												</div>
												<div class="col-3">
													<div class="flex-center-right">
														<div id="modal-info-profileImage" class="avatar" style=""></div>
													</div>
												</div>
										  </div>
										</div>
								  </div>
			            <div class="modal-body">

										<div class="container" style="padding:0!important">

												<div class="form-group input-group copy-input">
																<div class="input-group-prepend">
		                        		<span class="input-group-text transparent left-icon"><i class="fas fa-envelope" style="margin-left:2px"></i>	</span>
															</div>
												       <input id="modal-info-email" type="text" value="email@gmail.com" class="form-control">
												       <div class="input-group-append">
												          <span class="input-group-text copy-icon"><i class="pg-icon">copy</i></span>
												       </div>
												</div>
												<div class="form-group input-group copy-input">
																<div class="input-group-prepend">
		                        		<span class="input-group-text transparent left-icon"> <i class="fas fa-phone-alt" style="margin-left:3px"></i> 	</span>
															</div>
												       <input id="modal-info-phone" type="text" value="+3161234567" class="form-control">
												       <div class="input-group-append">
												          <span class="input-group-text copy-icon"> <i class="pg-icon">copy</i></span>
												       </div>
												</div>



													<p class="bold separator">Work</p>
													<div class="form-group form-group-default no-focus tag-list">
														<div class="form-group-prepend-text"> Skills: </div>
														<div class="tags" id="modal-info-skills">
															<button class="btn btn-chip">Editor</button>
															 <button class="btn btn-chip">Motion</button>
															 <button class="btn btn-chip">Film</button>
														</div>
													</div>
													<div class="form-group form-group-default no-focus tag-list">
														<div class="form-group-prepend-text"> Worked on: </div>
														<div class="tags" id="modal-info-workedOn">
															<button class="btn btn-chip">Volkswagen</button>
															 <button class="btn btn-chip">Stuff</button>
														</div>
													</div>
													<br>
													<a href="" class="btn btn-block btn-achtung btn-lg btn-icon-right">
														<span id="modal-info-website" style="text-align:left" class="icon-link"><i class="fas fa-globe-europe"></i>Website</span>
														<i class="pg-icon md-18">arrow_right</i>
													</a>
														<a href="" class="btn btn-block btn-achtung btn-lg btn-icon-right ">
															<span id="modal-info-linkedin" style="text-align:left" class="icon-link"><i class="fab fa-linkedin"></i>LinkedIn</span>
															<i class="pg-icon md-18">arrow_right</i>
														</a>
														<a href="" class="btn btn-block btn-achtung btn-lg btn-icon-right">
															<span id="modal-info-instagram" style="text-align:left" class="icon-link"><i class="fab fa-instagram"></i>Instagram</span>
															<i class="pg-icon md-18">arrow_right</i>
														</a>

													<div id="modal-info-notes-wrapper">
														<p class="bold separator">Notes</p>
														<p id="modal-info-notes">Test</p>
													</div>
										</div>
			            </div>
								</div>
							</div>



		        </div>
		        </div>
		    </div>
		</div>
		<!-- /.CONTACT MODAL -->


	<!-- BEGIN VENDOR JS -->
	    <!-- BEGIN VENDOR JS -->
		<script src="../assets/plugins/classie/classie.js" type="text/javascript"></script>
		<script data-pace-options='{ "ajax": false }' src="../assets/plugins/pace/pace.min.js" type="text/javascript"></script>
		<script src="../assets/plugins/jquery/jquery-3.2.1.min.js" type="text/javascript"></script>
		<script src="../assets/plugins/modernizr.custom.js" type="text/javascript"></script>
		<script src="../assets/plugins/jquery-ui/jquery-ui.min.js" type="text/javascript"></script>
		<script src="../assets/plugins/popper/umd/popper.min.js" type="text/javascript"></script>
		<script src="../assets/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
		<script src="../assets/plugins/jquery/jquery-easy.js" type="text/javascript"></script>
		<script src="../assets/plugins/jquery-unveil/jquery.unveil.min.js" type="text/javascript"></script>
		<script src="../assets/plugins/jquery-ios-list/jquery.ioslist.min.js" type="text/javascript"></script>
		<script src="../assets/plugins/jquery-actual/jquery.actual.min.js"></script>
		<script src="../assets/plugins/jquery-scrollbar/jquery.scrollbar.min.js"></script>
		<script src="../assets/plugins/datatables/DataTables-1.10.24/js/jquery.dataTables.min.js" type="text/javascript"></script>
		<script src="../assets/plugins/datatables/Responsive-2.2.7/js/dataTables.responsive.min.js" type="text/javascript"></script>
		<script src="../assets/plugins/datatables-responsive/js/lodash.min.js" type="text/javascript"></script>

		<script type="text/javascript" src="../assets/plugins/css-element-queries/ResizeSensor.js"></script>
		<script type="text/javascript" src="../assets/plugins/css-element-queries/ElementQueries.js"></script>
		<script type="text/javascript" src="../assets/plugins/swiper6.4.15/swiper-bundle.min.js"></script>
		<script type="text/javascript" src="../assets/plugins/copyclick/copyclick.js"></script>

    <!-- END VENDOR JS -->
    <!-- BEGIN CORE TEMPLATE JS -->
    <script src="../pages/js/pages.min.js" type="text/javascript"></script>
    <!-- END CORE TEMPLATE JS -->
	<!-- BEGIN PAGE LEVEL JS -->
	<script src="../assets/js/scripts.js" type="text/javascript"></script>


	<!-- LoginETC -->
	<script>


		var swiper;
		var currentPersonUid;
		var contactsTable;
		var currentUser;
		var currentListUid = '';

		//////////////////////// INIT TABLE /////////////////////////





		//////////////////////// USER HANDLING /////////////////////////

		document.addEventListener('DOMContentLoaded', function() {
			const db = firebase.firestore();

			firebase.auth().onAuthStateChanged((user) => {
				if(user){

					currentUser = user;
					initPage();

					if(user.photoURL)
						$('#account-photo').attr("src", user.photoURL);
						$('#account-profileImage').css('background-image', 'url(' + user.photoURL + ')' )

					if(user.displayName)
						$('#account-name').html(user.displayName);

						$('#account-displayname').html(user.displayName);
						$('#account-email').html(user.email);
						if(user.isAdmin){
							$('#account-isadmin').html('Admin');
						} else {
							$('#account-isadmin').html('Author');
						}



					var userdoc = db.collection("users").doc(user.uid).get().then((doc) => {
							if (doc.exists) {
								if (doc.data().isAdmin) {
									console.log("User is an Admin");
								} else {
									console.log("User is not an Admin");
									// window.location.href = '../';
								}
							} else {
									console.log("No such document!");
									window.location.href = '../error';
							}
					}).catch((error) => {
							console.log("Error getting document:", error);
					});

				} else {
					window.location.href = '../login';
				}

			});

			$('#sign-out').click(function() { firebase.auth().signOut() });

			function initPage(){
				// $('body').show();
				initTable();
				updateReviewMenu();
				initLists();
			}

			function initTable(){
				var settings = {
									"sDom": "<t><'row'<p i>>",
									"destroy": true,
									"scrollCollapse": true,
									"oLanguage": {
											"sLengthMenu": "_MENU_ ",
											"sInfo": "Showing <b>_START_ to _END_</b> of _TOTAL_ entries"
									},
									columns: [
							        { responsivePriority: 1 },
							        { responsivePriority: 7 },
							        { responsivePriority: 6 },
							        { responsivePriority: 8 },
							        { responsivePriority: 3 },
							        { responsivePriority: 9 },
											{ responsivePriority: 5 },
											{ responsivePriority: 4 },
											{ responsivePriority: 2 }
							    ],
								// "scrollCollapse": true,
								// "scrollX": true,
								responsive: {
										details: false
								},
							bLengthChange : false,
							lengthChange: false,
							"pagingType": "numbers",
							columnDefs: [
								{
										targets:  [ 1, 2, 5, 7 ],
										visible: false,
										searchable: true
								},
							 { orderable: false, targets: -1 }
						 ],
						 'createdRow': function(row, data, dataIndex){
								$('td:eq(5)', row).css('min-width', '110px');
						 },
						 "fnDrawCallback": function(oSettings) {
	 								$('.dataTables_scrollHead').hide();
	 							 if ($('#example tr').length < 20) {
	 									 $('.dataTables_paginate').hide();
	 									 $('.dataTables_info').hide();
	 							 }
	 					 }
				};

				contactsTable = $('#contactsTable').DataTable(settings);

				// search box for table
				$('#search-table-full').keyup(function() {
					contactsTable.search($(this).val()).draw();
				});

			}

			function updateReviewMenu(){
				db.collection("contacts").where("approvedStatus", "==", "pending").get().then(function(querySnapshot) {
					var count = 0;
					querySnapshot.forEach(function(doc) {
						count ++
					});
					if(count > 0){$("#menu-review-icon").html(count).addClass('highlight')}
				});
			}


			function initLists(){

				var userdoc = db.collection("users").doc(currentUser.uid).collection('lists').get().then(function(querySnapshot) {
				$('#lists-ul').empty();
				$('#mobile-list-select').empty();

				querySnapshot.forEach(function(doc) {
					$('#lists-ul').append('<li class="list-title" data-uid="'+ doc.id +'"><i class="pg-icon" >list_bullets</i><input disabled value="'+doc.data().title+'"></input></li>');
					$('#mobile-list-select').append('<option value="'+doc.id+'">'+doc.data().title+'</option>');
					if(currentListUid == ''){ currentListUid = doc.id	}
				});

				var el = $('#mobile-list-select').get(0);
				$(el).wrap('<div class="cs-wrapper full-width"></div>');
				new SelectFx(el);

				$('#mobile-list-select').change(function() {
					 addListToTable($(this).find(':selected').val());
					 $('.list-title').removeClass('active');
					 $('.list-title[data-uid='+ $(this).find(':selected').val() +']').addClass('active');
				});


				$('#lists-ul').append('<li id="add-new-list"class="new-list"><h5><i class="pg-icon">add</i>New list</h5></li>');
				$('#add-new-list').click(function() { newList('New List') });
					$('.list-title').click(function() {
						if($(this).hasClass('active')){
							console.log('clicked');
							$(this).find('input').prop( "disabled", false ).focus().select();
						} else {
							$('.list-title').removeClass('active');
							$(this).addClass('active');
							addListToTable($(this).data('uid'));
						}
					});

					$('#delete-cancel').click(function() {
						$('#modalDeleteList').modal('hide');
					});

					$('#delete-list').click(function() {
						console.log('test');
						db.collection("users").doc(currentUser.uid).collection('lists').doc(currentListUid).delete().then(() => {
						    console.log("List successfully deleted!");
								$('#modalDeleteList').modal('hide');
								$('.list-title[data-uid='+ currentListUid +']').remove();
								currentListUid = $('.list-title').first().data('uid');
								addListToTable(currentListUid);
						}).catch((error) => {
						    console.error("Error removing list: ", error);
						});
					});

					$('.list-title input').focusout(function() {
						updateListTitle($(this));
					});

					addListToTable(currentListUid);

				}).catch((error) => {
						console.log("Error getting user:", error);
				});

			}

			function newList(title){
				console.log(currentUser);
				db.collection("users").doc(currentUser.uid).collection('lists').add({
					title: '',
					people: []
				}).then((docRef) => {
					console.log('New list created, enter title' + docRef.id);
					$('<div class="list-title" data-uid="'+ docRef.id +'"><i class="pg-icon" >list_bullets</i><input value=""></input></div>').insertBefore('#add-new-list');
					$('.list-title[data-uid='+ docRef.id +'] input').focus();
					$('.list-title[data-uid='+ docRef.id +'] input').focusout(function() {
						updateListTitle($(this));
				  });
					addListToTable(docRef.id);
				});
			}



			$('#new-person').click(function() {
				window.location.href = '../';
			});



			function updateListTitle(titleInput){
				var theUid = titleInput.parent().data( "uid" );
				db.collection("users").doc(currentUser.uid).collection('lists').doc(theUid).update({
					title: titleInput.val()
				}).then((docRef) => {
					console.log('title updated');
				});
				titleInput.prop( "disabled", true );
			}

			function addListToTable(listUID) {
				currentListUid = listUID;
				$('#contactTableWrapper').addClass('hideMe');
				$(".list-title").removeClass('active');
				$('.list-title[data-uid='+ listUID +']').addClass('active');

				db.collection("users").doc(currentUser.uid).collection('lists').doc(listUID).get().then((doc) => {

						contactsTable.clear();

						doc.data().people.forEach(function(contactUid) {
							db.collection("contacts").doc(contactUid).get().then((doc) => {

								var person = doc.data();
								//ADD TO TABLE
		 						contactsTable.row.add([
									makeAvatarName(person),
									makePosition(person),
									person.location,
									'<span class="copy-click" data-tooltip-text="Click To Copy" data-tooltip-text-copied="✔ Copied">'+ person.email + '</span>' ,
									makeTags(person.skills),
									makeTags(person.workedOn),
									makeRate(person.rate),
									makeButtons(person),
									'<a  aria-label="" data-uid="'+ doc.id + '" type="button" class="remove-button btn btn-achtung btn-animated from-top"> <span> <i class="pg-icon">minus</i> </span> <span class="hidden-block"> <i class="pg-icon">minus</i> </span> </a>'
								]);


								setTimeout(function(){
									 $(".remove-button[data-uid='" + doc.id + "']").parent().parent().attr('data-uid', doc.id );

									 $('#contactsTable tr').on('click', function() {
	 									var uid = $(this).attr('data-uid');
	 									console.log(uid);
	 									if(uid){ putPersonInModal(uid) }
	 								 });

									 $(".remove-button").click(function(event){ event.stopPropagation() });

									 $("td a").click(function(event){ event.stopPropagation() });

									 initCopyClick();

								}, 30);

								if(person.profileImageUrl == ''){
									person.profileImageUrl = 'assets/img/profiles/0.png'
								}



								$('#contactTableWrapper').removeClass('hideMe');

								contactsTable.draw();
								$(window).trigger('resize');



							});
						});

				});

			}


			$('#modalContactView').on('shown.bs.modal', function (e) {
				setTimeout(function () {	$('#modalContactView').css('overflow-y','auto')	}, 300);
			})
			$('#modalContactView').on('hidden.bs.modal', function (e) {
				setTimeout(function () { $('#modalContactView').css('overflow-y','hidden') }, 300);
			})

			function initWorkSwiper(){
				swiper = new Swiper('#workSwiper', {
					slidesPerView: 1,
					centeredSlides: true,
					spaceBetween: 1,
					grabCursor: true,
					speed: 500,
					pagination: {
						el: '.swiper-pagination',
						clickable: true,
					},
					autoplay: {
						 delay: 3000,
					}
				});

				var element = document.getElementById('modalContent');
				new ResizeSensor(element, function() {
						swiper.update();
				});
			}

			function putPersonInModal(uid){

				var userdoc = db.collection("contacts").doc(uid).get().then((doc) => {
						if (doc.exists) {
								var person = doc.data();

								$('#modal-info-name').html(person.firstName + ' ' + person.lastName);
								$('#modal-info-email').val(person.email);
								if(person.phone != ''){
									$('#modal-info-phone').parent().show();
									$('#modal-info-phone').val(person.phone);
								} else {
									$('#modal-info-phone').parent().hide();
								}
								if(person.status != 'Freelancer'){
									$('#modal-info-position').html(person.jobTitle + ', ' + person.company);
								} else {
									if(person.rate !=''){
										$('#modal-info-position').html('Freelancer,' + person.rate + '<small>/h</small>');
									} else {
										$('#modal-info-position').html('Freelancer');
									}
								}
								if(person.location != ''){
									$('#modal-info-location').parent().show();
									$('#modal-info-location').html(person.location);
								} else {
									$('#modal-info-location').parent().hide();
								}

								if(person.profileImageUrl != ''){
									$('#modal-info-profileImage').show();
									$('#modal-info-profileImage').css('background-image', 'url('+ person.profileImageUrl +')');
								} else {
									$('#modal-info-profileImage').hide();
								}

								if(person.website != ''){
									$('#modal-info-website').parent().show();
									$('#modal-info-website').attr("href", person.website);
								} else {
									$('#modal-info-website').parent().hide();
								}

								if(person.linkedin != ''){
									$('#modal-info-linkedin').parent().show();
									$('#modal-info-linkedin').attr("href", person.linkedin);
								} else {
									$('#modal-info-linkedin').parent().hide();
								}

								if(person.instagram != ''){
									$('#modal-info-instagram').parent().show();
									$('#modal-info-instagram').attr("href", person.instagram);
								} else {
									$('#modal-info-instagram').parent().hide();
								}

								if(person.notes != ''){
									$('#modal-info-notes-wrapper').show();
									$('#modal-info-notes').html(person.notes);
								} else {
									$('#modal-info-notes-wrapper').hide();
								}

								if(person.skills != []){
									$('#modal-info-skills').empty();
									person.skills.forEach(function(skill) {
											$('#modal-info-skills').append( '<button class="btn btn-chip">'+ skill +'</button>');
									});
								}
								if(person.workedOn.length > 0){
									$('#modal-info-workedOn').parent().show();

									$('#modal-info-workedOn').empty();
									person.workedOn.forEach(function(client) {
											$('#modal-info-workedOn').append( '<button class="btn btn-chip">'+ client +'</button>');
									});
								} else {
									$('#modal-info-workedOn').parent().hide();
								}

								if(person.featuredWork){
									if(person.featuredWork.length > 0){
										$('#workColumn').show();
										$('#infoColumn').removeClass('col-12').addClass('col-md-6');
										$('#workSwiper').remove();
										$('#workColumn').prepend('	<div id="workSwiper" class="swiper-container"> <div class="swiper-wrapper"></div> <div class="swiper-pagination"></div> 	</div>');

										person.featuredWork.forEach(function(imageUrl) {
											$('#workSwiper .swiper-wrapper').append( '<div class="swiper-slide"><div class="imageWrap" style="background-image: url('+imageUrl+')"></div></div>');
										});

										initWorkSwiper();

									} else {
										$('#workColumn').hide();
										$('#infoColumn').removeClass('col-md-6').addClass('col-12');
									}
								} else {
									$('#workColumn').hide();
									$('#infoColumn').removeClass('col-md-6').addClass('col-12');
								}

								$('#modalContactView').modal();

						} else {
								console.log("No such document!");
						}
				}).catch((error) => {
						console.log("Error getting document:", error);
				});

			}


			function makeAvatarName(person){
				if(person.profileImageUrl){
					return '<div class="flex-cell"><span class="thumbnail-wrapper d32 circular inline"><img src="'+ person.profileImageUrl +'" alt="" data-src="'+ person.profileImageUrl +'" data-src-retina="'+ person.profileImageUrl +'" width="32" height="32"></span><span class="name">'+ person.firstName + ' ' + person.lastName +'</span></div>'
				} else 	{
					return '<div class="flex-cell"><span class="thumbnail-wrapper d32 circular inline"></span><span class="name">'+ person.firstName + ' ' + person.lastName +'</span></div>'
				}
			}

			function makeAvatarDisplayName(person){
				if(person.profileImageUrl){
					return '<div class="flex-cell"><span class="thumbnail-wrapper d32 circular inline"><img src="'+ person.profileImageUrl +'" alt="" data-src="'+ person.profileImageUrl +'" data-src-retina="'+ person.profileImageUrl +'" width="32" height="32"></span><span class="name">'+ person.displayName +'</span></div>'
				} else 	{
					return '<div class="flex-cell"><span class="thumbnail-wrapper d32 circular inline"></span><span class="name">'+ person.displayName +'</span></div>'
				}
			}

			function makeRole(person){
				if(person.isAdmin){
					return '<select class="cs-select cs-skin-slide admin-select" data-init-plugin="cs-select"><option value="true" selected>Admin</option><option value="false">Author</option></select>'
				} else 	{
					return '<select class="cs-select cs-skin-slide admin-select" data-init-plugin="cs-select"><option value="true">Admin</option><option value="false" selected>Author</option></select>'
				}
			}

			function makeButtons(person){
				var linkshtml = '';

				if(person.website != '' && person.website != undefined)
					linkshtml = linkshtml + '<a target="_blank" href="'+ person.website +'" aria-label="" type="button" class="btn btn-achtung"><span> <i class="fas fa-globe-europe"></i> </span></a>'

				if(person.linkedin != '' && person.linkedin != undefined)
					linkshtml = linkshtml + '<a target="_blank" href="'+ person.linkedin +'" aria-label="" type="button" class="btn btn-achtung"><span> <i class="fab fa-linkedin"></i> </span></a>'

				if(person.instagram != '' && person.instagram != undefined)
					linkshtml = linkshtml + '<a target="_blank" href="'+ person.instagram +'" aria-label="" type="button" class="btn btn-achtung"><span> <i class="fab fa-instagram"></i> </span></a>'

				return linkshtml
			}
			function makePosition(person){
				if(person.status != 'Freelancer'){
					return 	person.jobTitle + ', ' + person.company;
				} else {
					return 	'Freelancer';
				}
			}
			function makeTags(tagArray){
				var html = '';
				tagArray.forEach(function(item) {
				    html = html + ' <button class="btn btn-chip">'+ item +'</button>';
				});
				return html
			}


						function makeRate(rate){
							var html = '';
							if(rate != '')
							    html = '€'+ rate +'<small style="opacity:0.6">/h</small>';
							return html
						}



			//////////////////////// HELPERS /////////////////////////

			$('#sidebar-modal-shade').on('click', function() {
				$('[data-toggle="sidebar"]').trigger( "click" );
				$('#sidebar-modal-shade').removeClass('show');
			});

			$('.toggle-sidebar').on('click', function() {
				if($('.page-sidebar').hasClass('visible')){
				 $('#sidebar-modal-shade').removeClass('show');
			 } else {
				 $('#sidebar-modal-shade').addClass('show');
			 }
		 });

			$('.copy-input').on('click', function() {
				  // finds data-clipboard-test for content p class "click"
				   copyText = $(this).find( "input" );
					 /* Select the text field */
					 copyText.select();
					 /* Copy the text inside the text field */
					 document.execCommand("copy");

					 $('body').pgNotification({
						 	style: 'bar',
							message: 'Copied to clipboard!',
							timeout: 1500,
							type: 'success',
							position: 'top'
					 }).show();

				})



		});// END ON DOM LOADED


	</script>
	<!-- END PAGE LEVEL JS -->
</body>

</html>

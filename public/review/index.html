<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="content-type" content="text/html;charset=UTF-8" />
	<meta charset="utf-8" />
	<title>List of Awesome</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<link rel="apple-touch-icon" href="../../assets/img/favicon/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="76x76" href="../../assets/img/favicon/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="120x120" href="../../assets/img/favicon/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="152x152" href="../../assets/img/favicon/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="180x180" href="../../assets/img/favicon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="../../assets/img/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="../../assets/img/favicon/favicon-16x16.png">
	<link rel="icon" type="image/x-icon" href="../../assets/img/favicon/favicon.ico" />
	<link rel="manifest" href="../../assets/img/favicon/site.webmanifest">
	<meta name="msapplication-TileColor" content="#da532c">
	<meta name="theme-color" content="#ffffff">

	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-touch-fullscreen" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="default">
	<meta content="" name="description" />
	<meta content="Luke Vink" name="author" />

	<link href="../assets/plugins/pace/pace-theme-flash.css" rel="stylesheet" type="text/css" />
	<link href="../assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
	<link href="../assets/plugins/font-awesome-5/css/all.css" rel="stylesheet" type="text/css" />
	<link href="../assets/plugins/jquery-scrollbar/jquery.scrollbar.css" rel="stylesheet" type="text/css"
		media="screen" />
	<link href="../assets/plugins/select2/css/select2.min.css" rel="stylesheet" type="text/css" media="screen" />
	<link href="../assets/plugins/codrops-dialogFx/dialog.css" rel="stylesheet" type="text/css" media="screen" />
	<link href="../assets/plugins/codrops-dialogFx/dialog-sandra.css" rel="stylesheet" type="text/css" media="screen" />
	<link href="../assets/plugins/owl-carousel/../assets/owl.carousel.css" rel="stylesheet" type="text/css"
		media="screen" />
	<link href="../assets/plugins/jquery-nouislider/jquery.nouislider.css" rel="stylesheet" type="text/css"
		media="screen" />
	<link href="../assets/plugins/jquery-metrojs/MetroJs.css" rel="stylesheet" type="text/css" media="screen" />
	<link href="../assets/plugins/datatables/DataTables-1.10.24/css/jquery.dataTables.min.css" rel="stylesheet"
		type="text/css">
	<link href="../assets/plugins/datatables/Responsive-2.2.7/css/responsive.bootstrap4.min.css" rel="stylesheet"
		type="text/css">
	<link rel="stylesheet" href="../assets/plugins/swiper6.4.15/swiper-bundle.min.css" />
	<link href="../assets/plugins/jquery-bar-rating/themes/fontawesome-stars.css" rel="stylesheet">

	<link class="main-stylesheet" href="../pages/css/themes/achtung.css" rel="stylesheet" type="text/css" />
	<link class="main-stylesheet" href="../assets/css/style.css" rel="stylesheet" type="text/css" />


	<script defer="" src="/__/firebase/8.3.1/firebase-app.js"></script>
	<script defer="" src="/__/firebase/8.3.1/firebase-auth.js"></script>
	<script defer="" src="/__/firebase/8.3.1/firebase-firestore.js"></script>
	<script defer="" src="/__/firebase/8.3.1/firebase-storage.js"></script>
	<script defer="" src="/__/firebase/8.3.1/firebase-analytics.js"></script>
	<script defer="" src="/__/firebase/8.3.1/firebase-remote-config.js"></script>
	<script defer="" src="/__/firebase/8.3.1/firebase-performance.js"></script>
	<!--
		initialize the SDK after all desired features are loaded, set useEmulator to false
		to avoid connecting the SDK to running emulators.
	-->
	<script defer="" src="/__/firebase/init.js?useEmulator=true"></script>


</head>

<body class="fixed-header menu-pin menu-behind">
	<nav class="page-sidebar" data-pages="sidebar">
		<!-- BEGIN SIDEBAR MENU TOP TRAY CONTENT-->


		<div class="sidebar-overlay-slide from-top" id="appMenu">
		</div>
		<!-- END SIDEBAR MENU TOP TRAY CONTENT-->
		<!-- BEGIN SIDEBAR MENU HEADER-->


		<div class="sidebar-header">
			<!--
			<img src="../assets/img/logo_white.png" alt="logo" class="brand" data-src="../assets/img/logo_white.png" data-src-retina="../assets/img/logo_white_2x.png" width="78" height="22">
			<div class="sidebar-header-controls">
			  <button aria-label="Toggle Drawer" type="button" class="btn btn-icon-link invert sidebar-slide-toggle m-l-20 m-r-10" data-pages-toggle="#appMenu">
							<i class="pg-icon">chevron_down</i>
			  </button>
			  <button aria-label="Pin Menu" type="button" class="btn btn-icon-link invert d-lg-inline-block d-xlg-inline-block d-md-inline-block d-sm-none d-none" data-toggle-pin="sidebar">
							<i class="pg-icon"></i>
			  </button>
			</div>
	-->
		</div>
		<!-- END SIDEBAR MENU HEADER-->
		<!-- START SIDEBAR MENU -->


		<div class="sidebar-menu">
			<!-- BEGIN SIDEBAR MENU ITEMS-->


			<ul class="menu-items">
				<li class="m-t-30">
					<a href="../"><span class="title">All People</span></a> <span class="icon-thumbnail"><i
							class="pg-icon">users</i></span>
				</li>
				<li class="">
					<a href="../add"><span class="title">Add Person</span></a> <span class="icon-thumbnail"><i
							class="pg-icon">user_add</i></span>
				</li>
				<li class="active">
					<a href=""><span class="title">Needs Review</span></a> <span class="icon-thumbnail"><i
							class="pg-icon" id="menu-review-icon">star</i></span>
				</li>
				<li class="">
					<a href="../lists"><span class="title">My Lists</span></a> <span class="icon-thumbnail"><i
							class="pg-icon">pin</i></span>
				</li>
				<li class="">
					<a href="../settings"><span class="title">Settings</span></a> <span class="icon-thumbnail"><i
							class="pg-icon">cog</i></span>
				</li>
			</ul>


			<div class="clearfix">
			</div>
		</div>
		<!-- END SIDEBAR MENU -->
	</nav>
	<!-- END SIDEBAR -->
	<!-- END SIDEBAR -->
	<!-- START PAGE-CONTAINER -->


	<div class="page-container">
		<div class="filter-modal-shade" id="sidebar-modal-shade">
		</div>
		<!-- START PAGE HEADER WRAPPER -->
		<!-- START HEADER -->


		<div class="header">
			<!-- START MOBILE SIDEBAR TOGGLE -->
			<a class="btn-link toggle-sidebar d-lg-none pg-icon btn-icon-link" data-toggle="sidebar" href="#">menu</a>
			<!-- END MOBILE SIDEBAR TOGGLE -->


			<div class="">
				<div class="brand inline m-l-10"><img alt="logo" data-src="../assets/img/logo.png"
						data-src-retina="../assets/img/logo.png" height="50" src="../assets/img/logo.png">
				</div>
				<!--                <a href="#" class="search-link d-lg-inline-block d-none" style="margin-left:50px;" data-toggle="search"><i class="pg-icon">search</i>Type anywhere to <span class="bold">search</span></a> -->
			</div>


			<div class="d-flex align-items-center">
				<!-- START User Info-->


				<div class="dropdown pull-right d-lg-block">
					<button aria-expanded="false" aria-haspopup="true" aria-label="profile dropdown"
						class="profile-dropdown-toggle" data-toggle="dropdown" type="button"><span
							class="thumbnail-wrapper d32 circular inline"><img height="32" id="account-photo"
								src="../assets/img/profiles/0.png" width="32"></span></button>

					<div class="dropdown-menu dropdown-menu-right profile-dropdown" role="menu">
						<a class="dropdown-item" href="#"><span>Signed in as<br>
								<b><span id="account-name">Achtung!<span></span></span></b></span></a>

						<div class="dropdown-divider">
						</div>
						<a class="dropdown-item">Settings</a> <a class="dropdown-item" id="sign-out">Sign Out</a>
					</div>
				</div>
				<!-- END User Info-->
				<!--
					<a href="#" class="header-icon m-l-5 sm-no-margin d-inline-block" data-toggle="quickview"
						data-toggle-element="#quickview">
						<i class="pg-icon btn-icon-link">menu_add</i>
					</a>
	-->
			</div>
		</div>
		<!-- END HEADER -->
		<!-- END PAGE HEADER WRAPPER -->
		<!-- START PAGE CONTENT WRAPPER -->


		<div class="page-content-wrapper">
			<!-- START PAGE CONTENT -->


			<div class="content">
				<!-- START CONTAINER FLUID -->


				<div class="container-fluid">
					<!-- BEGIN PlACE PAGE CONTENT HERE -->


					<div class="row d-flex" style="margin-top:24px;">
						<div class="col-md-6 m-none" style="overflow:none;">
							<h4>Needs Review</h4>
						</div>


						<div class="col-md-6 m-centered" style="text-align:right">
							<!-- <a href="/add" id="add-row"  class="btn btn-primary btn-huge "><span class="icon-thumbnail "><i class="pg-icon">user_add</i></span>Add someone awesome</a> -->
						</div>
					</div>
					<!-- <div class="search-wrapper">
							<input type="text" id="search-table-full" class="form-control pull-right" placeholder="Search">
						</div> -->
					<!-- BEGIN TABLE -->


					<div class="hideMe" id="contactTableWrapper">
						<table cellspacing="0" class="table table-hover" id="contactsTable" width="100%">
							<thead>
								<tr>
									<th>uid</th>
									<th class="no-sort">
										<div class="table-circle"></div>
									</th>
									<th>Name</th>
									<th>Email</th>

									<th>Skills</th>

									<th>Worked On</th>

									<th class="no-sort">links</th>

									<th class="no-sort">
									</th>
								</tr>
							</thead>


							<tbody>
							</tbody>
						</table>
					</div>
					<!-- END TABLE -->



					<div class="row d-flex" style="margin-top:24px;">
						<div class="col-md-6 m-none" style="overflow:none;">
							<h4>People with errors</h4>
						</div>


						<div class="col-md-6 m-centered" style="text-align:right">
							<!-- <a href="/add" id="add-row"  class="btn btn-primary btn-huge "><span class="icon-thumbnail "><i class="pg-icon">user_add</i></span>Add someone awesome</a> -->
						</div>
					</div>

					<div class="hideMe" id="errorTableWrapper">
						<table cellspacing="0" class="table table-hover" id="errorTable" width="100%">
							<thead>
								<tr>
									<th>uid</th>
									<th class="no-sort">
										<div class="table-circle"></div>
									</th>
									<th>Name</th>
									<th>Email</th>
									<th>Skills</th>
									<th>Error</th>
									<th class="no-sort">links</th>
									<th class="no-sort">
									</th>
								</tr>
							</thead>


							<tbody>
							</tbody>
						</table>
					</div>
					<!-- END TABLE -->



				</div>
				<!-- END CONTAINER FLUID -->
			</div>
			<!-- END PAGE CONTENT -->
			<!-- START FOOTER -->
			<!--
				<div class="container-fluid container-fixed-lg footer">
					<div class="copyright sm-text-center">
						<p class="small no-margin pull-left sm-pull-reset">
							<span class="hint-text">Copyright © 2014</span>
							<span class="font-montserrat">REVOX</span>.
							<span class="hint-text">All rights reserved.</span>
							<span class="sm-block"><a href="#" class="m-l-10 m-r-10">Terms of use</a> | <a href="#"
									class="m-l-10">Privacy Policy</a>
							</span>
						</p>
						<p class="small no-margin pull-right sm-pull-reset">
							<a href="#">Hand-crafted</a>
							<span class="hint-text">&amp; Made with Love ®</span>
						</p>
						<div class="clearfix"></div>
					</div>
				</div>
	-->
			<!-- END FOOTER -->
		</div>
		<!-- END PAGE CONTENT WRAPPER -->
	</div>
	<!-- END PAGE CONTAINER -->


	<!-- CONTACT MODAL -->
	<div aria-hidden="false" aria-labelledby="modalSlideUpLabel" class="modal fade slide-up" id="modalContactView"
		role="dialog" tabindex="-1">
		<div class="modal-dialog modal-lg">
			<div class="modal-content-wrapper">
				<div class="modal-content" id="modalContent">
					<div class="row" style="width:100%; margin:0;">
						<div class="col-md-6 no-padding" id="workColumn">
							<div class="swiper-container" id="workSwiper">
								<div class="swiper-wrapper"></div>
								<div class="swiper-pagination"></div>
							</div>
						</div>
						<div class="col-md-6" id="infoColumn">
							<div class="modal-header clearfix text-left">
								<button aria-hidden="true" aria-label="" class="close" data-dismiss="modal"
									type="button"><i class="pg-icon">close</i></button>
								<div class="container">
									<div class="flex-cell">
										<div>
											<div class="flex-center-left" style="margin-right:20px;">
												<div class="avatar" id="modal-info-profileImage" style=""></div>
											</div>
										</div>
										<div>
											<h3><span class="semi-bold" id="modal-info-name">John Smith</span></h3>
											<h6><i class="pg-icon"
													style="vertical-align: bottom; margin-right:10px;">user</i><span
													id="modal-info-position"></span></h6>
											<h6><i class="pg-icon"
													style="vertical-align: bottom; margin-right:10px;">map</i><span
													id="modal-info-location"></span></h6>
										</div>
									</div>
								</div>
							</div>
							<div class="modal-body top">
								<div class="container">
									<div class="form-group input-group copy-input">
										<div class="input-group-prepend">
											<span class="input-group-text transparent left-icon"><i
													class="fas fa-envelope" style="margin-left:2px"></i></span>
										</div><input class="form-control" id="modal-info-email" type="text"
											value="email@gmail.com">
										<div class="input-group-append">
											<span class="input-group-text copy-icon"><i class="pg-icon">copy</i></span>
										</div>
									</div>
									<div class="form-group input-group copy-input">
										<div class="input-group-prepend">
											<span class="input-group-text transparent left-icon"><i
													class="fas fa-phone-alt" style="margin-left:3px"></i></span>
										</div><input class="form-control" id="modal-info-phone" type="text"
											value="+3161234567">
										<div class="input-group-append">
											<span class="input-group-text copy-icon"><i class="pg-icon">copy</i></span>
										</div>
									</div>
								</div>
							</div>
							<div class="modal-body bottom">
								<div class="container">
									<div class="form-group form-group-default no-focus tag-list">
										<div class="form-group-prepend-text">
											Skills:
										</div>
										<div class="tags" id="modal-info-skills"></div>
									</div>
									<div class="form-group form-group-default no-focus tag-list">
										<div class="form-group-prepend-text">
											Worked on:
										</div>
										<div class="tags" id="modal-info-workedOn"></div>
									</div>
									<div class="form-group form-group-default no-focus tag-list">
										<div class="form-group-prepend-text">
											Rating:
										</div><select class="formRating" id="modal-info-rating">
											<option value="1">
												1
											</option>
											<option value="2">
												2
											</option>
											<option value="3">
												3
											</option>
											<option value="4">
												4
											</option>
											<option value="5">
												5
											</option>
										</select>
									</div>
									<div class="form-group-flex-container">
										<div class="form-group form-group-default no-focus tag-list half-width">
											<div class="form-group-prepend-text">
												Hourly Rate:
											</div>
											<div class="form-text-right" id="modal-info-hrRate">
												€200<small>p/h</small>
											</div>
										</div>
										<div class="form-group form-group-default no-focus tag-list half-width">
											<div class="form-group-prepend-text">
												Day Rate:
											</div>
											<div class="form-text-right" id="modal-info-dayRate">
												€200<small>p/h</small>
											</div>
										</div>
									</div>
									<br>
									<br>
									<a class="btn btn-block btn-achtung btn-lg" href="" target="_blank"><span
											class="icon-link" id="modal-info-website" style="text-align:left"><i
												class="fas fa-globe-europe"></i>Website</span> <i
											class="pg-icon md-18">arrow_right</i></a> <a
										class="btn btn-block btn-achtung btn-lg" href="" target="_blank"><span
											class="icon-link" id="modal-info-linkedin" style="text-align:left"><i
												class="fab fa-linkedin"></i>LinkedIn</span> <i
											class="pg-icon md-18">arrow_right</i></a> <a
										class="btn btn-block btn-achtung btn-lg" href="" target="_blank"><span
											class="icon-link" id="modal-info-instagram" style="text-align:left"><i
												class="fab fa-instagram"></i>Instagram</span> <i
											class="pg-icon md-18">arrow_right</i></a>
								</div>
							</div>


							<div class="modal-body notes">
								<p class="bold separator">Notes</p>
								<div class="container">
									<div id="modal-info-notes-wrapper">
										<p id="modal-info-notes">Some info on this person</p>
									</div>
								</div>
							</div>
							<!-- <a href="" style="margin-top:20px" class="btn btn-block btn-achtung btn-lg faded-out">
                                                    <span id="modal-edit-person" style="text-align:left" class="icon-link"><i class="fas fa-user-edit"></i>Edit this person</span>
                                                </a> -->
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	</div>
	</div><!-- /.CONTACT MODAL -->


	<!-- BEGIN VENDOR JS -->
	<!-- BEGIN VENDOR JS -->
	<script src="../assets/plugins/pace/pace.min.js" type="text/javascript"></script>
	<script src="../assets/plugins/jquery/jquery-3.2.1.min.js" type="text/javascript"></script>
	<script src="../assets/plugins/modernizr.custom.js" type="text/javascript"></script>
	<script src="../assets/plugins/jquery-ui/jquery-ui.min.js" type="text/javascript"></script>
	<script src="../assets/plugins/popper/umd/popper.min.js" type="text/javascript"></script>
	<script src="../assets/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
	<script src="../assets/plugins/jquery/jquery-easy.js" type="text/javascript"></script>
	<script src="../assets/plugins/jquery-unveil/jquery.unveil.min.js" type="text/javascript"></script>
	<script src="../assets/plugins/jquery-ios-list/jquery.ioslist.min.js" type="text/javascript"></script>
	<script src="../assets/plugins/jquery-actual/jquery.actual.min.js"></script>
	<script src="../assets/plugins/jquery-scrollbar/jquery.scrollbar.min.js"></script>
	<script type="text/javascript" src="../assets/plugins/datatables/DataTables-1.10.24/js/jquery.dataTables.min.js">
	</script>
	<script type="text/javascript" src="../assets/plugins/datatables/Responsive-2.2.7/js/dataTables.responsive.min.js">
	</script>

	<script src="../assets/plugins/jquery-metrojs/MetroJs.min.js" type="text/javascript"></script>
	<script type="text/javascript" src="../assets/plugins/classie/classie.js"></script>
	<script type="text/javascript" src="../assets/plugins/jquery-bar-rating/jquery.barrating.min.js"></script>
	<script src="../assets/plugins/imagesloaded/imagesloaded.pkgd.min.js"></script>
	<script src="../assets/plugins/jquery-isotope/isotope.pkgd.min.js" type="text/javascript"></script>
	<script src="../assets/plugins/codrops-dialogFx/dialogFx.js" type="text/javascript"></script>
	<script src="../assets/plugins/owl-carousel/owl.carousel.min.js" type="text/javascript"></script>
	<script src="../assets/plugins/jquery-nouislider/jquery.nouislider.min.js" type="text/javascript"></script>
	<script src="../assets/plugins/jquery-nouislider/jquery.liblink.js" type="text/javascript"></script>
	<script src="../assets/plugins/css-element-queries/ResizeSensor.js"></script>
	<script src="../assets/plugins/css-element-queries/ElementQueries.js"></script>
	<script src="../assets/plugins/swiper6.4.15/swiper-bundle.min.js"></script>
	<script src="../assets/plugins/copyclick/copyclick.js"></script>

	<!-- BEGIN CORE TEMPLATE JS -->
	<script src="../pages/js/pages.min.js" type="text/javascript"></script>
	<!-- END CORE TEMPLATE JS -->


	<!-- LoginETC -->
	<script>
		var swiper;
		var currentPersonUid;
		var currnetUser;
		var isAdmin;

		//////////////////////// INIT TABLE /////////////////////////

		var settings = {
			"sDom": "<t><'row'<p i>>",
			"destroy": true,
			"scrollCollapse": true,
			"oLanguage": {
				"sLengthMenu": "_MENU_ ",
				"sInfo": "Showing <b>_START_ to _END_<\/b> of _TOTAL_ people",
				"sEmptyTable": "No people are waiting to be reviewed"
			},
			columns: [{
					responsivePriority: 7
				}, //UID
				{
					responsivePriority: 1
				}, //AVATAR
				{
					responsivePriority: 0
				}, //NAME
				{
					responsivePriority: 5
				}, //EMAIL
				{
					responsivePriority: 3
				}, //SKILLS
				{
					responsivePriority: 2
				}, //WORKED ON
				{
					responsivePriority: 6
				}, //LINKS
				{
					responsivePriority: 4
				} //BUTTONS
			],
			columnDefs: [{
					targets: [0],
					visible: false,
					searchable: true
				},
				{
					"targets": 'no-sort',
					"orderable": false,
				}
			],
			responsive: {
				details: false
			},
			bLengthChange: false,
			lengthChange: false,
			"paging": false,
			drawCallback: function (settings) {
				var pagination = $(this).closest('.dataTables_wrapper').find('.dataTables_paginate');
				pagination.toggle(this.api().page.info().pages > 1);
				var info = $(this).closest('.dataTables_wrapper').find('.dataTables_info');
				info.toggle(this.api().page.info().pages > 1);
			},
			'createdRow': function (row, data, dataIndex) {
				$('td:eq(0)', row).css('max-width', '70px').css('padding-right', '-5px');
				$('td:eq(1)', row).css('min-width', '150px');
				$('td:eq(2)', row).css('min-width', '200px');
				$('td:eq(4)', row).css('min-width', '300px');
				$('td:eq(5)', row).css('min-width', '106px');
				$('td:eq(6)', row).css('min-width', '180px');
				if (!isAdmin) {
					$('td:eq(6)', row).css('min-width', '30px');
				}
			}
		};




		var contactsTable = $('#contactsTable').DataTable(settings);

		$('.formRating').barrating({
			theme: 'fontawesome-stars',
			readonly: true,
		});


		//////////////////////// USER HANDLING /////////////////////////

		document.addEventListener('DOMContentLoaded', () => {
			const db = firebase.firestore();


			firebase.auth().onAuthStateChanged((user) => {
				if (user) {

					if (user.photoURL)
						$('#account-photo').attr("src", user.photoURL);

					if (user.displayName)
						$('#account-name').html(user.displayName);

					var userdoc = db.collection("users").doc(user.uid).get().then((doc) => {
						if (doc.exists) {
							if (doc.data().isAdmin) {
								isAdmin = true;
								console.log("User is an Admin");

							} else {
								console.log("User is not an Admin");
								isAdmin = false;
							}

							addContactsToTable();
							addContactsToErrorTable();

						} else {
							console.log("No such document!");
							window.location.href = '../error';
						}
					}).catch((error) => {
						console.log("Error getting document:", error);
					});

				} else {
					window.location.href = '../login';
				}

			});

			$('#sign-out').click(function () {
				firebase.auth().signOut();
			});


			//////////////////////// REVIEW TABLE /////////////////////////

			function addContactsToTable() {

				var count = 0;

				db.collection("contacts").where("approvedStatus", "==", "pending").get().then(function (
					querySnapshot) {
					querySnapshot.forEach(function (doc) {
						var person = doc.data();

						//ADD TO TABLE
						contactsTable.row.add([
							doc.id,
							makeAvatar(doc),
							makeNameAndJob(doc),
							'<span class="copy-click" data-tooltip-text="Click To Copy" data-tooltip-text-copied="✔ Copied">' +
							person.email + '</span>',
							makeTags(person.skills),
							makeTags(person.workedOn),
							makeLinks(person),
							makeButtons(doc),
						]);

						setTimeout(() => {
							$(":button[data-uid='" + doc.id + "']").parent().parent().attr(
								'data-uid', doc.id);
						}, 50);

						count++
					});

					if (count > 0) {
						$("#menu-review-icon").html(count).addClass('highlight')
					}

					//////////////// ADD ACTIONS TO TABLE //////////////////

					contactsTable.draw();
					$(window).trigger('resize');

					if (!isAdmin) {
						contactsTable.column(7).visible(false)
					}
					contactsTable.column(5).visible(false)

					contactsTable.on('draw', function () {
						updateTableMethods();
					});

					initCopyClick();

					$('#contactTableWrapper').removeClass('hideMe');

					//////////////////////////////////

				});

			}

			$('#modalContactView').on('shown.bs.modal', function (e) {
				setTimeout(function () {
					$('#modalContactView').css('overflow-y', 'auto')
				}, 300);
			})
			$('#modalContactView').on('hidden.bs.modal', function (e) {
				setTimeout(function () {
					$('#modalContactView').css('overflow-y', 'hidden')
				}, 300);
			})


			//////////////////////// ERROR TABLE /////////////////////////


			var settingsErrorTable = {
				"sDom": "<t><'row'<p i>>",
				"destroy": true,
				"scrollCollapse": true,
				"oLanguage": {
					"sLengthMenu": "_MENU_ ",
					"sInfo": "Showing <b>_START_ to _END_<\/b> of _TOTAL_ people",
					"sEmptyTable": "No people are waiting to be reviewed"
				},
				columns: [{
						responsivePriority: 7
					}, //UID
					{
						responsivePriority: 1
					}, //AVATAR
					{
						responsivePriority: 0
					}, //NAME
					{
						responsivePriority: 5
					}, //EMAIL
					{
						responsivePriority: 3
					}, //SKILLS
					{
						responsivePriority: 2
					}, //ERROR
					{
						responsivePriority: 6
					}, //LINKS
					{
						responsivePriority: 4
					} //EDIT
				],
				responsive: {
					details: false
				},
				bLengthChange: false,
				lengthChange: false,
				"paging": false,
				columnDefs: [{
						targets: [0],
						visible: false,
						searchable: true
					},
					{
						"targets": 'no-sort',
						"orderable": false,
					}
				],
				drawCallback: function (settings) {
					var pagination = $(this).closest('.dataTables_wrapper').find('.dataTables_paginate');
					pagination.toggle(this.api().page.info().pages > 1);
					var info = $(this).closest('.dataTables_wrapper').find('.dataTables_info');
					info.toggle(this.api().page.info().pages > 1);
				},
				'createdRow': function (row, data, dataIndex) {
					$('td:eq(0)', row).css('max-width', '70px').css('padding-right', '-5px');
					$('td:eq(1)', row).css('min-width', '150px');
					$('td:eq(2)', row).css('min-width', '200px');
					$('td:eq(4)', row).css('min-width', '300px');
					$('td:eq(5)', row).css('min-width', '106px');
					$('td:eq(6)', row).css('min-width', '30px');
				}
			};

			var errorTable = $('#errorTable').DataTable(settingsErrorTable);


			function addContactsToErrorTable() {

				var count = 0;

				db.collection("contacts").orderBy('error').get().then(function (querySnapshot) {
					querySnapshot.forEach(function (doc) {
						var person = doc.data();

						//ADD TO TABLE
						errorTable.row.add([
							doc.id,
							makeAvatar(doc),
							makeNameAndJob(doc),
							(person.email) ?
							'<span class="copy-click" data-tooltip-text="Click To Copy" data-tooltip-text-copied="✔ Copied">' +
							person.email + '</span>' : 'NO EMAIL',
							makeTags(person.skills),
							person.error,
							makeLinks(person),
							'<a href="/edit?id=' + doc.id +
							'" class="btn btn-achtung btn-lg btn-animated from-bottom"><span> <i class="pg-icon">edit</i> </span> <span class="hidden-block"> <i class="pg-icon">edit</i> </span></a>'
						]);

						setTimeout(() => {
							$(":button[data-uid='" + doc.id + "']").parent().parent().attr(
								'data-uid', doc.id);
						}, 50);

						count++
					});

					if (count > 0) {
						$("#menu-review-icon").html(count).addClass('highlight')
					}

					//////////////// ADD ACTIONS TO TABLE //////////////////

					errorTable.draw();
					$(window).trigger('resize');

					if (!isAdmin) {
						errorTable.column(7).visible(false)
					}

					updateTableMethods();
					errorTable.on('draw', function () {
						updateTableMethods();
					});

					initCopyClick();
					$('#errorTableWrapper').removeClass('hideMe');

					//////////////////////////////////

				});

			}





			function updateTableMethods() {

				$('.table-hover tr').on('click', function (e) {
					var uid = $(this).data('uid');
					if (uid) {
						putPersonInModal(uid)
					}
				});


				$('.accept').on('click', function (e) {
					e.stopPropagation();
					var uid = $(this).parent().parent().attr('data-uid');
					reviewPerson(uid, true);
				});

				$('.reject').on('click', function (e) {
					e.stopPropagation();
					var uid = $(this).parent().parent().attr('data-uid');
					reviewPerson(uid, false);
				});


				$(".person-uid").each(function (index) {
					let uid = $(this).attr('data-uid');
					$(this).parent().parent().attr('data-uid', uid);
				});

				$('.personRating').barrating({
					theme: 'fontawesome-stars',
					readonly: true,
					allowEmpty: true,
					initialRating: '',
					deselectable: true
				});
				$('.paginate_button').on('click', function () {
					updateTableMethods();
				});

				$("td a").click(function (event) {
					event.stopPropagation()
				});

			}


			function reviewPerson(uid, approve) {

				if (approve) {
					db.collection("contacts").doc(uid).update({
						approvedStatus: 'approved'
					}).then(() => {
						updateReviewMenu();
						var rowToRemove = $(".table-hover tr[data-uid='" + uid + "']");
						rowToRemove.fadeOut(400, function () {
							contactsTable.row(rowToRemove).remove().draw()
						});
					});
				} else {
					db.collection("contacts").doc(uid).update({
						approvedStatus: 'rejected'
					}).then(() => {
						updateReviewMenu();
						var rowToRemove = $(".table-hover tr[data-uid='" + uid + "']");
						rowToRemove.fadeOut(400, function () {
							contactsTable.row(rowToRemove).remove().draw()
						});
					});
				}

			}

			function initWorkSwiper() {


				swiper = new Swiper('#workSwiper', {
					slidesPerView: 1,
					centeredSlides: true,
					spaceBetween: 1,
					grabCursor: true,
					pagination: {
						el: '.swiper-pagination',
						clickable: true,
					},
					autoplay: {
						delay: 2000,
					}
				});

				var element = document.getElementById('modalContent');
				new ResizeSensor(element, () => {
					swiper.update();
				});


			}

			function putPersonInModal(uid) {

				var userdoc = db.collection("contacts").doc(uid).get().then((doc) => {

					if (doc.exists) {
						var person = doc.data();

						if (person.isCompany) {
							$('#modal-info-name').html(person.firstName);
						} else {
							$('#modal-info-name').html(person.firstName + ' ' + person.lastName);
						}

						if (person.email != '') {
							$('#modal-info-email').parent().show();
							$('#modal-info-email').val(person.email);
						} else {
							$('#modal-info-email').parent().hide();
						}

						if (person.phone != '') {
							$('#modal-info-phone').parent().show();
							$('#modal-info-phone').val(person.phone);
						} else {
							$('#modal-info-phone').parent().hide();
						}
						if (person.jobTitle == '') {
							if (person.rate != '') {
								$('#modal-info-position').html('Freelancer,' + person.rate +
									'<small>/h</small>');
							} else {
								$('#modal-info-position').html('Freelancer');
							}
						} else {
							if (person.rate != '') {
								$('#modal-info-position').html(person.jobTitle + ',' + person.rate +
									'<small>/h</small>');
							} else {
								$('#modal-info-position').html(person.jobTitle);
							}
						}
						if (person.location != '') {
							$('#modal-info-location').parent().show();
							$('#modal-info-location').html(person.location);
						} else {
							$('#modal-info-location').parent().hide();
						}

						if (person.profileImageUrl != '') {
							$('#modal-info-profileImage').show();
							$('#modal-info-profileImage').css('background-image', 'url(' + person
								.profileImageUrl + ')');
						} else {
							$('#modal-info-profileImage').hide();
						}

						if (person.rating) {
							$('#modal-info-rating').barrating('set', person.rating);
							$('#modal-info-rating').parent().parent().show();
						} else {
							$('#modal-info-rating').parent().parent().hide();
						}

						if (person.rate) {
							$('#modal-info-hrRate').html('<b>€' + person.rate + '<\/b> <small>p/h<\/small>');
							$('#modal-info-hrRate').parent().show();
						} else {
							$('#modal-info-hrRate').parent().hide();
						}

						if (person.dayRate) {
							$('#modal-info-dayRate').html('<b>€' + person.dayRate +
								'<\/b> <small>p/day<\/small>');
							$('#modal-info-dayRate').parent().show();
						} else {
							$('#modal-info-dayRate').parent().hide();
						}

						if (person.website != '') {
							$('#modal-info-website').parent().show();
							$('#modal-info-website').parent().attr("href", person.website);
						} else {
							$('#modal-info-website').parent().hide();
						}

						if (person.linkedin != '') {
							$('#modal-info-linkedin').parent().show();
							$('#modal-info-linkedin').parent().attr("href", person.linkedin);
						} else {
							$('#modal-info-linkedin').parent().hide();
						}

						if (person.instagram != '') {
							$('#modal-info-instagram').parent().show();
							$('#modal-info-instagram').parent().attr("href", person.instagram);
						} else {
							$('#modal-info-instagram').parent().hide();
						}

						if (person.notes != '' && isAdmin) {
							$('.modal-body.notes').show();
							$('#modal-info-notes').html(person.notes);
						} else {
							$('.modal-body.notes').hide();
						}

						if (person.skills != []) {
							$('#modal-info-skills').empty();
							person.skills.forEach(function (skill) {
								$('#modal-info-skills').append(
									'<button class="btn btn-chip" onclick="clickTag()">' + skill +
									'<\/button>');
							});
						}
						if (person.workedOn.length > 0) {
							$('#modal-info-workedOn').parent().show();

							$('#modal-info-workedOn').empty();
							person.workedOn.forEach(function (client) {
								$('#modal-info-workedOn').append(
									'<button class="btn btn-chip" onclick="clickTag()">' +
									client + '<\/button>');
							});
						} else {
							$('#modal-info-workedOn').parent().hide();
						}

						if (person.featuredWork) {
							if (person.featuredWork.length > 0) {
								$('#workColumn').show();
								$('#infoColumn').removeClass('col-12').addClass('col-md-6');
								$('#workSwiper').remove();
								$('#workColumn').prepend(
									'  <div id="workSwiper" class="swiper-container"> <div class="swiper-wrapper"><\/div> <div class="swiper-pagination"><\/div>     <\/div>'
								);

								person.featuredWork.forEach(function (imageUrl) {
									$('#workSwiper .swiper-wrapper').append(
										'<div class="swiper-slide"><div class="imageWrap" style="background-image: url(' +
										imageUrl + ')"><\/div><\/div>');
								});

								initWorkSwiper();

							} else {
								$('#workColumn').hide();
								$('#infoColumn').removeClass('col-md-6').addClass('col-12');
							}
						} else {
							$('#workColumn').hide();
							$('#infoColumn').removeClass('col-md-6').addClass('col-12');
						}

						$('#modalContactView').modal();

					} else {
						console.log("No such document!");
					}
				}).catch((error) => {
					console.log("Error getting document:", error);
				});

			}

			//////////////////////// TABLE HELPERS /////////////////////////


			function makeAvatarName(doc) {
				if (doc.data().profileImageUrl) {
					return '<span style="display:none" class="person-uid" data-uid="' + doc.id + '">' + doc.id +
						'<\/span>' +
						'<div class="flex-cell"><span class="thumbnail-wrapper d32 circular inline"><img src="' + doc
						.data().profileImageUrl + '" alt="" data-src="' + doc.data().profileImageUrl +
						'" data-src-retina="' + doc.data().profileImageUrl +
						'" width="32" height="32"><\/span><span class="name">' + doc.data().firstName + ' ' + doc
						.data().lastName + '<\/span><\/div>'
				} else {
					return '<span style="display:none" class="person-uid" data-uid="' + doc.id + '">' + doc.id +
						'<\/span>' +
						'<div class="flex-cell"><span class="thumbnail-wrapper d32 circular inline"><\/span><span class="name">' +
						doc.data().firstName + ' ' + doc.data().lastName + '<\/span><\/div>'
				}
			}

			function makeNameAndJob(doc) {
				var html = '<div class="flex-cell-vert"><span class="name">' + doc.data().firstName + ' ' + doc.data()
					.lastName + '<\/span><\/div>';

				if (doc.data().isCompany === true) {
					html = '<div class="flex-cell-vert"><span class="name">' + doc.data().firstName +
						'<\/span><\/div>';

					if (doc.data().location)
						html = '<div class="flex-cell-vert"><span class="name">' + doc.data().firstName +
						'<\/span><span class="title">' + doc.data().location + '<\/span><\/div>'
					if (doc.data().jobTitle)
						html = '<div class="flex-cell-vert"><span class="name">' + doc.data().firstName +
						'<\/span><span class="title">' + doc.data().jobTitle + '<\/span><\/div>'
					if (doc.data().jobTitle && doc.data().location)
						html = '<div class="flex-cell-vert"><span class="name">' + doc.data().firstName +
						'<\/span><span class="title">' + doc.data().jobTitle + ', ' + doc.data().location +
						'<\/span><\/div>'
				} else {
					if (doc.data().location)
						html = '<div class="flex-cell-vert"><span class="name">' + doc.data().firstName + ' ' + doc
						.data().lastName + '<\/span><span class="title">' + doc.data().location + '<\/span><\/div>'

					if (doc.data().jobTitle && doc.data().location)
						html = '<div class="flex-cell-vert"><span class="name">' + doc.data().firstName + ' ' + doc
						.data().lastName + '<\/span><span class="title">' + doc.data().jobTitle + ', ' + doc.data()
						.location + '<\/span><\/div>'
				}

				return html
			}

			function makeAvatar(doc) {
				if (doc.data().profileImageUrl) {
					return '<span style="display:none" class="person-uid" data-uid="' + doc.id + '">' + doc.id +
						'<\/span>' +
						'<div class="flex-cell"><span class="thumbnail-wrapper d32 circular inline no-margin"><img src="' +
						doc.data().profileImageUrl + '" alt="" data-src="' + doc.data().profileImageUrl +
						'" data-src-retina="' + doc.data().profileImageUrl +
						'" width="32" height="32"><\/span><\/div>'
				} else {
					return '<span style="display:none" class="person-uid" data-uid="' + doc.id + '">' + doc.id +
						'<\/span>' +
						'<div class="flex-cell"><span class="thumbnail-wrapper d32 circular inline no-margin"><\/span><\/div>'
				}
			}

			function makeLinks(person, addEmail) {
				var linkshtml = '';

				if (addEmail)
					linkshtml = linkshtml + '<a target="_blank" href="mailto:' + person.email +
					'" class="btn btn-achtung"><span> <i class="fas fa-envelope"></i> </span></a>'

				if (person.website != '' && person.website != undefined)
					linkshtml = linkshtml + '<a target="_blank" href="' + person.website +
					'"  class="btn btn-achtung"><span> <i class="fas fa-globe-europe"></i> </span></a>'

				if (person.linkedin != '' && person.linkedin != undefined)
					linkshtml = linkshtml + '<a target="_blank" href="' + person.linkedin +
					'" class="btn btn-achtung"><span> <i class="fab fa-linkedin"></i> </span></a>'

				if (person.instagram != '' && person.instagram != undefined)
					linkshtml = linkshtml + '<a target="_blank" href="' + person.instagram +
					'" class="btn btn-achtung"><span> <i class="fab fa-instagram"></i> </span></a>'


				return linkshtml
			}

			function makeButtons(doc) {

				var html = '<a href="/edit?id=' + doc.id +
					'" class="btn btn-achtung btn-lg btn-animated from-bottom" style="margin-right:15px;"><span> <i class="pg-icon">edit</i> </span> <span class="hidden-block"> <i class="pg-icon">edit</i> </span></a>';

				if (isAdmin) {
					html = '<a href="/edit?id=' + doc.id +
						'" class="btn btn-achtung btn-lg btn-animated from-bottom" style="margin-right:15px;"><span> <i class="pg-icon">edit</i> </span> <span class="hidden-block"> <i class="pg-icon">edit</i> </span></a>' +
						'<button aria-label="" data-uid="' + doc.id +
						'" type="button" class="reject btn btn-default btn-lg btn-rounded m-r-10 m-b-10 btn-animated from-top "> <span> <i class="pg-icon">close_ circle</i> </span> <span class="hidden-block"> <i class="pg-icon">close_ circle</i> </span> </button> <button aria-label="" data-uid="' +
						doc.id +
						'" type="button" class="accept btn btn-lg btn-rounded btn-primary m-r-10 m-b-10 btn-animated from-top"> <span> <i class="pg-icon">tick_circle</i> </span> <span class="hidden-block"> <i class="pg-icon">tick_circle</i> </span> </button>';
				}



				return html
			}

			function makePosition(person) {
				if (person.status != 'Freelancer') {
					return person.jobTitle + ', ' + person.company;
				} else {
					return 'Freelancer';
				}
			}

			function makeTags(tagArray) {
				var html = '';
				tagArray.forEach(function (item) {
					html = html + ' <button class="btn btn-chip">' + item + '</button>';
				});
				return html
			}


			//////////////////////// HELPERS /////////////////////////

			$('#sidebar-modal-shade').on('click', () => {
				$('[data-toggle="sidebar"]').trigger("click");
				$('#sidebar-modal-shade').removeClass('show');
			});

			$('.toggle-sidebar').on('click', () => {
				if ($('.page-sidebar').hasClass('visible')) {
					$('#sidebar-modal-shade').removeClass('show');
				} else {
					$('#sidebar-modal-shade').addClass('show');
				}
			});

			function updateReviewMenu() {
				db.collection("contacts").where("approvedStatus", "==", "pending").get().then(function (
					querySnapshot) {
					var count = 0;
					querySnapshot.forEach(function (doc) {
						count++
					});
					if (count > 0) {
						$("#menu-review-icon").html(count).addClass('highlight')
					}
				});
			}

			$('.copy-input').on('click', () => {
				// finds data-clipboard-test for content p class "click"
				copyText = $(this).find("input");
				/* Select the text field */
				copyText.select();
				/* Copy the text inside the text field */
				document.execCommand("copy");

				$('body').pgNotification({
					style: 'bar',
					message: 'Copied to clipboard!',
					timeout: 1500,
					type: 'success',
					position: 'top'
				}).show();

			});




		}); // END ON DOM LOADED
	</script>
	<!-- END PAGE LEVEL JS -->
</body>

</html>
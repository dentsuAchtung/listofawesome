<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="content-type" content="text/html;charset=UTF-8" />
	<meta charset="utf-8" />
	<title>List of Awesome - Edit Person</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<link rel="apple-touch-icon" href="../assets/img/favicon/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="76x76" href="../assets/img/favicon/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="120x120" href="../assets/img/favicon/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="152x152" href="../assets/img/favicon/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="180x180" href="../assets/img/favicon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="../assets/img/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="../assets/img/favicon/favicon-16x16.png">
	<link rel="icon" type="image/x-icon" href="../assets/img/favicon/favicon.ico" />
	<link rel="manifest" href="../assets/img/favicon/site.webmanifest">
	<meta name="msapplication-TileColor" content="#da532c">
	<meta name="theme-color" content="#ffffff">

	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-touch-fullscreen" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="default">
	<meta content="" name="description" />
	<meta content="" name="author" />

	<link class="main-stylesheet" href="../assets/css/style.css" rel="stylesheet" type="text/css">
	<link href="../assets/plugins/pace/pace-theme-flash.css" rel="stylesheet" type="text/css" />
	<link href="../assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
	<link href="../assets/plugins/font-awesome-5/css/all.css" rel="stylesheet" type="text/css">
	<link href="../assets/plugins/jquery-scrollbar/jquery.scrollbar.css" media="screen" rel="stylesheet"
		type="text/css">
	<link href="../assets/plugins/select2/css/select2.css" media="screen" rel="stylesheet" type="text/css">
	<link href="../assets/plugins/bootstrap-tag/bootstrap-tagsinput.css" rel="stylesheet" type="text/css">
	<link href="../assets/plugins/jquery-datatable/media/css/jquery.dataTables.css" rel="stylesheet" type="text/css">
	<link href="../assets/plugins/jquery-datatable/extensions/FixedColumns/css/dataTables.fixedColumns.min.css"
		rel="stylesheet" type="text/css">
	<link href="../assets/plugins/ion-slider/css/ion.rangeSlider.css" media="screen" rel="stylesheet" type="text/css">
	<link href="../assets/plugins/ion-slider/css/ion.rangeSlider.skinFlat.css" media="screen" rel="stylesheet"
		type="text/css">
	<link href="../assets/plugins/datatables-responsive/css/datatables.responsive.css" media="screen" rel="stylesheet"
		type="text/css">
	<link href="../assets/plugins/dropzone/css/dropzone.css" rel="stylesheet" type="text/css">
	<link class="main-stylesheet" href="../pages/css/themes/achtung.css" rel="stylesheet" type="text/css">
	<link class="main-stylesheet" href="../assets/css/style.css" rel="stylesheet" type="text/css">
	<link href="../assets/plugins/jquery-bar-rating/themes/css-stars.css" rel="stylesheet">

	<script defer="" src="/__/firebase/8.3.1/firebase-app.js"></script>
	<script defer="" src="/__/firebase/8.3.1/firebase-auth.js"></script>
	<script defer="" src="/__/firebase/8.3.1/firebase-firestore.js"></script>
	<script defer="" src="/__/firebase/8.3.1/firebase-storage.js"></script>
	<script defer="" src="/__/firebase/8.3.1/firebase-analytics.js"></script>
	<script defer="" src="/__/firebase/8.3.1/firebase-remote-config.js"></script>
	<script defer="" src="/__/firebase/8.3.1/firebase-performance.js"></script>
	<!--
		initialize the SDK after all desired features are loaded, set useEmulator to false
		to avoid connecting the SDK to running emulators.
	-->
	<script defer="" src="/__/firebase/init.js?useEmulator=true"></script>

</head>

<body class="fixed-header menu-pin menu-behind">
	<!-- BEGIN SIDEBAR -->
	<!-- BEGIN SIDEBPANEL-->
	<nav class="page-sidebar" data-pages="sidebar">
		<!-- BEGIN SIDEBAR MENU TOP TRAY CONTENT-->
		<div class="sidebar-overlay-slide from-top" id="appMenu">
		</div>
		<!-- END SIDEBAR MENU TOP TRAY CONTENT-->
		<!-- BEGIN SIDEBAR MENU HEADER-->
		<div class="sidebar-header">

		</div>
		<!-- END SIDEBAR MENU HEADER-->
		<!-- START SIDEBAR MENU -->
		<div class="sidebar-menu">
			<!-- BEGIN SIDEBAR MENU ITEMS-->
			<ul class="menu-items">
				<li class="m-t-30">
					<a href="../"><span class="title">All People</span></a>
					<span class="icon-thumbnail"><i class="pg-icon">users</i></span>
				</li>
				<li class="">
					<a href="../add"><span class="title">Add Person</span></a>
					<span class="icon-thumbnail "><i class="pg-icon">user_add</i></span>
				</li>
				<li class="">
					<a href="../review"><span class="title">Needs Review</span></a>
					<span class="icon-thumbnail "><i id="menu-review-icon" class="pg-icon">star</i></span>
				</li>
				<li class="">
					<a href="../lists"><span class="title">My Lists</span></a>
					<span class="icon-thumbnail "><i class="pg-icon">pin</i></span>
				</li>
				<li class="">
					<a href="../settings"> <span class="title">Settings</span></a>
					<span class="icon-thumbnail "><i class="pg-icon">cog</i></span>
				</li>
			</ul>
			<div class="clearfix"></div>
		</div>
		<!-- END SIDEBAR MENU -->
	</nav>
	<!-- END SIDEBAR -->
	<!-- END SIDEBAR -->
	<!-- START PAGE-CONTAINER -->
	<div class="page-container">
		<div id="sidebar-modal-shade" class="filter-modal-shade"></div>
		<!-- START PAGE HEADER WRAPPER -->
		<!-- START HEADER -->
		<div class="header ">
			<!-- START MOBILE SIDEBAR TOGGLE -->
			<a href="#" class="btn-link toggle-sidebar d-lg-none pg-icon btn-icon-link" data-toggle="sidebar">
				menu</a>
			<!-- END MOBILE SIDEBAR TOGGLE -->
			<div class="">
				<div class="brand inline  m-l-10 ">
					<img src="../assets/img/logo.png" alt="logo" data-src="../assets/img/logo.png"
						data-src-retina="../assets/img/logo.png" height="50">
				</div>

				<!-- 				<a href="#" class="search-link d-lg-inline-block d-none" style="margin-left:50px;" data-toggle="search"><i class="pg-icon">search</i>Type anywhere to <span class="bold">search</span></a> -->
			</div>
			<div class="d-flex align-items-center">
				<!-- START User Info-->
				<div class="dropdown pull-right d-lg-block">
					<button class="profile-dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true"
						aria-expanded="false" aria-label="profile dropdown">
						<span class="thumbnail-wrapper d32 circular inline">
							<img id="account-photo" src="../assets/img/profiles/0.png" width="32" height="32">
						</span>
					</button>
					<div class="dropdown-menu dropdown-menu-right profile-dropdown" role="menu">
						<a href="#" class="dropdown-item"><span>Signed in as <br /><b><span
										id="account-name">Achtung!<span></b></span></a>
						<div class="dropdown-divider"></div>
						<a class="dropdown-item">Settings</a>
						<a id="sign-out" class="dropdown-item">Sign Out</a>
					</div>
				</div>
				<!-- END User Info-->
				<!--
				<a href="#" class="header-icon m-l-5 sm-no-margin d-inline-block" data-toggle="quickview"
					data-toggle-element="#quickview">
					<i class="pg-icon btn-icon-link">menu_add</i>
				</a>
-->
			</div>
		</div>
		<!-- END HEADER -->
		<!-- END PAGE HEADER WRAPPER -->
		<!-- START PAGE CONTENT WRAPPER -->
		<div class="page-content-wrapper">
			<!-- START PAGE CONTENT -->
			<div class="content">

				<!-- START CONTAINER FLUID -->
				<div class="container-fluid container-fixed-lg">

					<div class="d-flex row" style="margin-top:24px;">
						<div class="col-10">
							<h4 id="title-text">Loading details...</h4>
							<p class=" mw-80 m-b-40">Make sure to add their photo and images of their work to help
								people recognize them.</p>
						</div>
						<div class="col-2" style="text-align:right; margin-top:20px;">
							<button id="delete-person" data-toggle="modal" data-target="#modalDeleteList"
								class="btn btn-huge just-icon"><span class="icon-thumbnail "><i
										class="pg-icon">trash_alt</i></span></button>
						</div>
					</div>


					<!-- BEGIN ADD PERSON ROW  -->
					<div class="d-flex row hideMe" id="addPersonForm">

						<div class="col-xl-8 col-lg-8">
							<!-- START card -->

							<form autocomplete="off" id="form-info" name="form-info" role="form">

								<div class="card card-default">
									<div class="card-header">
										<div class="card-title">
											General Info
										</div>
									</div>


									<div class="card-body">
										<div class="row clearfix hideMe" id="companyRow">
											<div class="col-md-12">
												<div class="form-group form-group-default required">
													<label>Company name</label> <input id="companyInput"
														class="form-control" name="company" minlength="2" required
														type="text">
												</div>
											</div>
										</div>

										<div class="row clearfix" id="personRow">
											<div class="col-md-6">
												<div class="form-group form-group-default required">
													<label>First name</label> <input class="form-control"
														name="firstName" minlength="2" required type="text">
												</div>
											</div>


											<div class="col-md-6">
												<div class="form-group form-group-default required">
													<label>Last name</label> <input class="form-control" name="lastName"
														minlength="2" required type="text">
												</div>
											</div>
										</div>


										<div class="row">
											<div class="col-md-12">
												<div class="form-group form-group-default input-group required">
													<div class="form-input-group">
														<label>Email</label> <input class="form-control" name="email"
															required type="email">
													</div>
													<div class="input-group-append">
														<span class="input-group-text"><i
																class="pg-icon">mail</i></span>
													</div>
												</div>
											</div>
										</div>

										<div class="row">
											<div class="col-md-12">
												<div class="form-group form-group-default input-group">
													<div class="form-input-group">
														<label>Phone Number</label> <input class="form-control"
															name="phone">
													</div>
													<div class="input-group-append">
														<span class="input-group-text"><i
																class="fas fa-phone-alt"></i></span>
													</div>
												</div>
											</div>
										</div>

										<div class="row">
											<div class="col-md-12">
												<div class="form-group form-group-default input-group">
													<div class="form-input-group">
														<label>Location</label> <input class="form-control"
															name="location">
													</div>
													<div class="input-group-append">
														<span class="input-group-text"><i class="pg-icon">map</i></span>
													</div>
												</div>
											</div>
										</div>

										<div class="clearfix"></div>

									</div>
								</div>
								<!-- START card -->


								<div class="card card-default">
									<div class="card-header">
										<div class="card-title">
											Work & Skills
										</div>
									</div>

									<div class="card-body">

										<div class="row clearfix">
											<div class="col-md-4">
												<div class="form-group form-group-default">
													<label id="jobTitle-text">Job Title</label> <input
														class="form-control" name="jobTitle" type="text">
												</div>
											</div>

											<div class="col-md-8 last-child" id="ratingContainer">
												<div class="form-group form-group-default tag-list">
													<div class="form-group-prepend-text"> Rating: </div>
													<select class="formRating" id="rating">
														<option selected="" value=""></option>
														<option value="1">1</option>
														<option value="2">2</option>
														<option value="3">3</option>
														<option value="4">4</option>
														<option value="5">5</option>
													</select>
												</div>
											</div>

										</div>



										<div class="row clearfix">
											<div class="col-xl-12">
												<div
													class="form-group form-group-default form-group-default-select2 required">
													<label>Skills</label>
													<select class="required full-width" id="skills-select"
														name="skillsSelect" multiple required>
													</select>
												</div>
											</div>
										</div>

										<div class="row clearfix">
											<div class="col-xl-12">
												<div class="form-group form-group-default form-group-default-select2">
													<label>Worked with us on:</label>
													<select class=" full-width" id="prior-work-select"
														placeholder="Type to search..." multiple>
														<optgroup id="client-options" label="Clients">
														</optgroup>
													</select>
												</div>
											</div>
										</div>

										<div class="row clearfix">

											<div class="col-md-6" id="hrRateSliderContainer">
												<div
													class="form-group form-group-focusless form-group-slider-stretched">
													<div class="leftBox">
														<label>Hourly Rate</label> <input class="form-control"
															placeholder="â‚¬---" name="hrRate" type="text" readonly>
													</div>
													<div class="rightBox">
														<div class="irs-wrapper primary">
															<input type="text" id="hrRateSlider" name="hrRateSlider"
																value="0;2057" />
														</div>
													</div>
												</div>
											</div>

											<div class="col-md-6" id="dayRateSliderContainer">
												<div
													class="form-group form-group-focusless form-group-slider-stretched">
													<div class="leftBox">
														<label>Daily Rate</label> <input class="form-control"
															placeholder="â‚¬---" name="dayRate" type="text" readonly>
													</div>
													<div class="rightBox">
														<div class="irs-wrapper primary">
															<input type="text" id="dayRateSlider" name="dayRateSlider"
																value="0;2057" />
														</div>
													</div>
												</div>
											</div>
										</div>


										<div class="row">
											<div class="col-md-12">
												<div class="form-group form-group-default">
													<label>Extra Notes</label>
													<textarea id="notes" class="form-control multiline" name="notes"
														rows="5"></textarea>
												</div>
											</div>
										</div>

									</div>
								</div> <!-- END GEN INFO CARD -->


								<div class="card card-default">
									<div class="card-header">
										<div class="card-title">
											Links
										</div>
									</div>

									<div class="card-body">

										<div class="row">
											<div class="col-md-12">
												<div class="form-group form-group-default input-group">
													<div class="form-input-group">
														<label>Website</label> <input class="form-control"
															name="website">
													</div>
													<div class="input-group-append">
														<span class="input-group-text"><i
																class="fas fa-globe-europe"></i></span>
													</div>
												</div>
											</div>
										</div>

										<div class="row">
											<div class="col-md-12">
												<div class="form-group form-group-default input-group">
													<div class="form-input-group">
														<label>LinkedIn</label> <input class="form-control"
															name="linkedin">
													</div>
													<div class="input-group-append">
														<span class="input-group-text"><i
																class="fab fa-linkedin"></i></span>
													</div>
												</div>
											</div>
										</div>

										<div class="row">
											<div class="col-md-12">
												<div class="form-group form-group-default input-group">
													<div class="form-input-group">
														<label>Instragram</label> <input class="form-control"
															name="instagram">
													</div>
													<div class="input-group-append">
														<span class="input-group-text"><i
																class="fab fa-instagram"></i></span>
													</div>
												</div>
											</div>
										</div>

										<div class="clearfix"></div>

									</div> <!-- END LINKS CARD -->


								</div>
						</div>


						</form> <!-- END DETAILS FORM  -->



						<!-- BEGIN IMAGES COLUMN  -->
						<div class="col-xl-4 col-lg-4">

							<div class="container-fluid d-flex h-100 flex-column no-padding">
								<div class="row ">

									<div class="card card-default">
										<div id="google-search-popup" class="card-popup closed">
											<div class="card-popup-loader"></div>

											<button id="google-search-close"
												class="btn btn-lg btn-rounded card-popup-close"><i
													class="pg-icon">close_lg</i></button>
											<div class="card-header">
												<div class="card-title">
													From google images:
												</div>
											</div>
											<div id="google-image-results" class="image-grid"></div>
										</div>
										<div class="card-header">
											<div class="card-title">
												Profile Photo
											</div>
											<button disabled id="google-search"
												class="btn btn-lg btn-rounded google-search closed">Search
												Google</button>
										</div>

										<div class="card-body no-scroll no-padding">
											<div class="flex-center">
												<div class="avatar-wrapper">
													<div class="profile-pic">
														<img class="profile-pic-image" id="profile-pic-image" src="" />
													</div>
													<div class="upload-button">
														<i class="fa fa-arrow-circle-up" aria-hidden="true"></i>
													</div>
													<input id="profileImageInput" class="file-upload" type="file"
														accept="image/*" />
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="row flex-fill d-flex ">

									<div class="card card-default">
										<div class="card-header">
											<div class="card-title">
												Featured Work
											</div>
										</div>


										<div class="card-body no-scroll no-padding dropzone-card">
											<form id="workDropzone" action="/file-upload" class="dropzone edit">
												<div class="fallback">
													<input name="file" type="file" multiple />
												</div>
											</form>
											<div id="currentWorkImages">


											</div>
										</div>
									</div>
								</div>

								<div class="row ">
									<div class="card card-default">
										<div class="card-body">
											<div class="row">
												<div class="col-xl-12 col-lg-12">
													<button aria-label=""
														class="btn btn-primary-rounded pull-right btn-lg btn-block"
														id="add-person" type="submit" style="font-weight: 700">Save
														Person</button>
												</div>
											</div>
										</div>
									</div>
								</div>


							</div>
						</div> <!-- END IMAGES COLUMN  -->



					</div> <!-- END ADD PERSON ROW  -->

					<!-- BEGIN EXTRA SPACE  -->
					<div class="row">
						<div class="col-xl-12 col-lg-12">
							<br><br>
						</div>
					</div>
					<!-- END EXTRA SPACE  -->


					<!-- END PAGE CONTENT WRAPPER -->
				</div>
				<!-- END PAGE CONTAINER -->


				<!-- BEGIN VENDOR JS -->

				<script data-pace-options='{ "ajax": false }' src="../assets/plugins/pace/pace.min.js"
					type="text/javascript"></script>
				<script src="../assets/plugins/jquery/jquery-3.2.1.min.js" type="text/javascript"></script>
				<script src="../assets/plugins/modernizr.custom.js" type="text/javascript"></script>
				<script src="../assets/plugins/jquery-ui/jquery-ui.min.js" type="text/javascript"></script>
				<script src="../assets/plugins/popper/umd/popper.min.js" type="text/javascript"></script>
				<script src="../assets/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
				<script src="../assets/plugins/jquery/jquery-easy.js" type="text/javascript"></script>
				<script src="../assets/plugins/jquery-unveil/jquery.unveil.min.js" type="text/javascript"></script>
				<script src="../assets/plugins/jquery-ios-list/jquery.ioslist.min.js" type="text/javascript"></script>
				<script src="../assets/plugins/jquery-actual/jquery.actual.min.js"></script>
				<script src="../assets/plugins/jquery-scrollbar/jquery.scrollbar.min.js"></script>
				<script src="../assets/plugins/bootstrap-tag/bootstrap-tagsinput.min.js" type="text/javascript">
				</script>
				<script src="../assets/plugins/select2/js/select2.full.min.js" type="text/javascript"></script>
				<script src="../assets/plugins/dropzone/dropzone.js" type="text/javascript"></script>
				<script src="../assets/plugins/classie/classie.js" type="text/javascript"></script>
				<script src="../assets/plugins/ion-slider/js/ion.rangeSlider.min.js" type="text/javascript"></script>

				<script src="../assets/plugins/jquery-datatable/media/js/jquery.dataTables.min.js"
					type="text/javascript"></script>
				<script src="../assets/plugins/jquery-datatable/extensions/TableTools/js/dataTables.tableTools.min.js"
					type="text/javascript"></script>
				<script src="../assets/plugins/jquery-datatable/extensions/Bootstrap/jquery-datatable-bootstrap.js"
					type="text/javascript"></script>
				<script src="../assets/plugins/datatables-responsive/js/datatables.responsive.js"
					type="text/javascript"></script>
				<script src="../assets/plugins/datatables-responsive/js/lodash.min.js" type="text/javascript"></script>
				<script src="../assets/plugins/jquery-validation/js/jquery.validate.min.js" type="text/javascript">
				</script>
				<script type="text/javascript" src="../assets/plugins/jquery-bar-rating/jquery.barrating.min.js">
				</script>

				<!-- END VENDOR JS -->

				<!-- BEGIN CORE TEMPLATE JS -->
				<script src="../pages/js/pages.min.js" type="text/javascript"></script>
				<!-- END CORE TEMPLATE JS -->

				<!-- BEGIN PAGE LEVEL JS -->
				<script src="../assets/js/scripts.js" type="text/javascript"></script>

				<script>
					Dropzone.autoDiscover = false;

					var newPersonInfo = {},
						currentUser,
						isAdmin = false,
						firstName = '',
						lastName = '',
						email = '',
						phone = '',
						profileImage,
						profileImageName,
						profileImageUrl,
						skills,
						featuredWork = [],
						status = '',
						jobTitle = '',
						company = '',
						isCompany = false,
						website = '',
						linkedin = '',
						featuredWork = [],
						instagram = '',
						notes = '',
						editUid = '',
						table = $('#tableWithSearch');

					var settings = {
						"sDom": "<t><'row'<p i>>",
						"destroy": true,
						"scrollCollapse": true,
						"oLanguage": {
							"sLengthMenu": "_MENU_ ",
							"sInfo": "Showing <b>_START_ to _END_</b> of _TOTAL_ entries"
						},
						"scrollX": true,
						bLengthChange: false,
						lengthChange: false,
						columnDefs: [{
							orderable: false,
							targets: -1
						}]
					};


					table.dataTable(settings);

					// search box for table
					$('#search-table-full').keyup(function () {
						table.fnFilter($(this).val());
					});


					$('#add-row').click(function () {
						table.dataTable().fnAddData([
							"Foo",
							"Bar"
						]);
					});

					$(document).ready(function () {

						$.validator.addMethod('validUrl', function (value, element) {
							var url = $.validator.methods.url.bind(this);
							return url(value, element) || url('https://' + value, element);
						}, 'Please enter a valid URL');

						$('#form-info').validate({
							rules: {
								skillsSelect: {
									minlength: 1
								},
								website: {
									required: false,
									validUrl: true
								},
								instagram: {
									required: false,
									validUrl: true
								},
								linkedin: {
									required: false,
									validUrl: true
								},
								email: {
									required: function () {
										//returns true if phone is empty   
										return !$('input[name="phone"]').val();
									}
								},
								phone: {
									required: function () {
										//returns true if email is empty
										return !$('input[name="email"]').val();
									}
								}
							},
							messages: {
								skillsSelect: {
									minlength: 'please select a skill'
								},
								email: "A valid email is needed if no phone number is added.",
								phone: "A phone number is required if no email is added."
							},
							focusInvalid: false,
							invalidHandler: function (form, validator) {

								if (!validator.numberOfInvalids())
									return;

								$('html, body').animate({
									scrollTop: ($(validator.errorList[0].element).offset().top) - 200
								}, 700);

							}
						});
						$('#form-info').submit(function (e) {
							e.preventDefault()
						});

						$("#add-person").click(addPerson);

						$('input[name="company"]').keyup(function () {
							$('input[name="firstName"]').val($(this).val())
							$('input[name="lastName"]').val($(this).val())
							firstName = $('input[name="company"]').val();
							lastName = $('input[name="company"]').val();
							updateAddButton();
							$('#google-image-results').empty();
						});

						$('input[name="firstName"]').keyup(function () {
							firstName = $('input[name="firstName"]').val();
							updateAddButton();
							$('#google-image-results').empty();
						});

						$('input[name="lastName"]').keyup(function () {
							lastName = $('input[name="lastName"]').val();
							updateAddButton();
							$('#google-image-results').empty();
						});

						var updateAddButton = () => {
							if (isCompany) {
								$('#add-person').html('Save ' + firstName);
							} else {
								$('#add-person').html('Save ' + firstName + ' ' + lastName);
							}
							if (firstName !== '' && lastName !== '') {
								$('#google-search').removeClass('closed').prop('disabled', false);;
							} else {
								$('#google-search').addClass('closed').prop('disabled', true);
							}
						}

						var typingTimer;
						var doneTypingInterval = 1000;

						$('input[name="email"]').keyup(function () {
							clearTimeout(typingTimer);
							typingTimer = setTimeout(getPhotoFromEmail, doneTypingInterval);
						});

						$('input[name="email"]').keydown(function () {
							clearTimeout(typingTimer);
						});

						function getPhotoFromEmail() {
							var dInput = $('input[name="email"]').val();
							var testEmail = /^[A-Z0-9._%+-]+@([A-Z0-9-]+\.)+[A-Z]{2,4}$/i;
							url = 'https://www.avatarapi.com/js.aspx?email=luke@lukevink.com&size=256'
							$.getScript(url);
							// if (testEmail.test(dInput)){
							// 	url = 'https://www.avatarapi.com/js.aspx?email=' + dInput + '&size=256'
							// 	$.getScript(url);
							// }

						}

						$("#google-search-close").click(function () {
							$("#google-search-popup").addClass('closed');
						});

						$("#google-search").click(function () {
							$("#google-search-popup").removeClass('closed');
							getGoogleImagesFromName();
						});


						function getGoogleImagesFromName() {

							if (firstName !== '' && lastName !== '' && $('#google-image-results').html() == '') {

								$('.card-popup-loader').removeClass('closed');

								if (isCompany) {
									url = 'https://api.valueserp.com/search?api_key=E157A44F14E54F7596383E719BD9E31D&q=' +
										firstName + '&search_type=images&output=json';
								} else {
									url = 'https://api.valueserp.com/search?api_key=E157A44F14E54F7596383E719BD9E31D&q=' +
										firstName + '+' + lastName + '&search_type=images&output=json';
								}

								$.get(url)
									.done(function (data) {

										$('.card-popup-loader').addClass('closed');

										let index = 0
										for (var item in data.image_results) {
											$('#google-image-results').append("<div class='google-image' data-imageurl='" +
												data.image_results[item].image + "' style='background-image: url(" +
												data.image_results[item].image + ");'/>");
											index += 1
											if (index > 14)
												break;
										}

										$('.google-image').click(function () {
											$("#google-search-popup").addClass('closed');
											var imageUrl = $(this).data("imageurl");
											profileImageName = imageUrl.substring(imageUrl.lastIndexOf("/") + 1,
												imageUrl.lastIndexOf("."));
											convertImgToDataURL(imageUrl, function (base64_data) {
												$('#profile-pic-image').attr('src', base64_data);
												profileImage = base64_data;
												uploadProfilePhoto(base64_data, profileImageName);
											});

										});


									})
									.fail(function () {
										console.log('Nothing found')
									})
							}

						}





						$('input[name="instagram"]').keyup(function () {
							clearTimeout(typingTimer);
							typingTimer = setTimeout(getPhotoFromInstagram, doneTypingInterval);
						});

						$('input[name="instagram"]').keydown(function () {
							clearTimeout(typingTimer);
						});

						function getPhotoFromInstagram() {

							var a = $('input[name="instagram"]').val();
							if (a.includes("instagram.com")) {
								var n = a.lastIndexOf('/');
								a = a.substring(n + 1).replace('/', '');;
							}

							// validation for instagram usernames
							var regex = new RegExp(/^(?!.*\.\.)(?!.*\.$)[^\W][\w.]{0,29}$/);
							var validation = regex.test(a);

							if (validation) {

								$.ajax({
										type: "POST",
										dataType: 'text',
										url: "https://www.instagram.com/" + a + "/?__a=1",
										username: 'user',
										password: 'pass',
										crossDomain: true,
										xhrFields: {
											withCredentials: true
										}
									})
									.done(function (data) {

										// getting the url
										var photoURL = data["graphql"]["user"]["profile_pic_url_hd"];

										// update img element
										$("#photoReturn").attr("src", photoURL)

									})
									.fail(function () {
										// code for 404 error 
										console.log('Username was not found!')
									})

							} else {
								console.log('The username is invalid!')
							}

						}

						var convertImgToDataURL = (url, callback) => {
							var img = new Image();

							img.crossOrigin = 'Anonymous';

							img.onload = function () {
								var canvas = document.createElement('CANVAS');
								var ctx = canvas.getContext('2d');
								var dataURL;
								canvas.height = this.height;
								canvas.width = this.width;
								ctx.drawImage(this, 0, 0);
								dataURL = canvas.toDataURL();
								callback(dataURL);
								canvas = null;
							};

							img.src = url;
						}

						// $("#status-select").select2({
						//   minimumResultsForSearch: Infinity
						// });

						// $("#status-select").change(function() {
						//   if($(this).val() == 'Freelancer'){
						// 	  $(".extra-status-option").addClass('hidden');
						// 		$("#rateSlider").hide();
						//   } else {
						// 	  $(".extra-status-option").removeClass('hidden');
						// 		$("#rateSlider").show();
						//   }
						// });

						$('#rating').barrating({
							theme: 'css-stars',
							allowEmpty: true,
							initialRating: 0,
						});

						//PROFILE IMAGE
						var readURL = function (input) {
							if (input.files && input.files[0]) {
								profileImageName = input.files[0].name;

								var reader = new FileReader();
								reader.onload = function (e) {
									//image is loaded;
									$('#profile-pic-image').attr('src', e.target.result);
									profileImage = e.target.result;
									uploadProfilePhoto(e.target.result, profileImageName);
								}
								reader.readAsDataURL(input.files[0]);

							}
							console.log(input.files);
						}

						$(".file-upload").on('change', function () {
							readURL(this);
						});


						$(".upload-button").on('click', function () {
							$(".file-upload").click();
						});

						$("#hrRateSlider").ionRangeSlider({
							min: 0,
							max: 600,
							type: 'single',
							prefix: "â‚¬",
							maxPostfix: "+",
							prettify: true,
							hasGrid: true,
							step: 5,
							onChange: function (data) {
								$('input[name="hrRate"]').val("â‚¬" + data.from);
							}
						});

						$("#dayRateSlider").ionRangeSlider({
							min: 0,
							max: 5000,
							type: 'single',
							prefix: "â‚¬",
							maxPostfix: "+",
							prettify: true,
							hasGrid: true,
							step: 5,
							onChange: function (data) {
								$('input[name="dayRate"]').val("â‚¬" + data.from);
							}
						});

						const db = firebase.firestore();

						//POPULATE CLIENTS
						db.collection("clients").get().then((querySnapshot) => {
							querySnapshot.forEach((doc) => {
								$("<option>").val(doc.data().name).text(doc.data().name).appendTo(
									"#client-options");
							});
						}).then(() => {
							$("#prior-work-select").select2();
						});

						//POPULATE SKILLS
						var skillGroups = '';
						db.collection("skills").orderBy("title", "desc").get().then((querySnapshot) => {
							querySnapshot.forEach((doc) => {
								var options = '';
								doc.data().options.forEach((option) => {
									options = options + '<option value="' + option + '">' + option +
										'</option>';
								});
								skillGroups = skillGroups + '<optgroup label="' + doc.data().title + '">' +
									options + '</optgroup>';
							});
							$("#skills-select").append(skillGroups);
						}).then(() => {
							$("#skills-select").select2();
							$('#addPersonForm').removeClass('hideMe');
						});

						firebase.auth().onAuthStateChanged((user) => {
							if (user) {

								currentUser = user;

								if (user.photoURL)
									$('#account-photo').attr("src", user.photoURL);

								if (user.displayName)
									$('#account-name').html(user.displayName);

								var userdoc = db.collection("users").doc(user.uid).get().then((doc) => {
									if (doc.exists) {
										if (doc.data().isAdmin) {
											console.log("User is an Admin");
											isAdmin = true;
										} else {
											console.log("User is not an Admin");
											isAdmin = false;
										}
									} else {
										console.log("No such document!");
										window.location.href = '../error';
									}
								}).catch((error) => {
									console.log("Error getting document:", error);
								});

							} else {
								window.location.href = '../login';
							}

						});

						$('#sign-out').click(function () {
							firebase.auth().signOut();
						});


						//SHOW REVIEW COUNT
						db.collection("contacts").where("approvedStatus", "==", "pending").get().then(function (
							querySnapshot) {
							var count = 0;
							querySnapshot.forEach(function (doc) {
								count++
							});
							if (count > 0) {
								$("#menu-review-icon").html(count).addClass('highlight')
							}
						});


						function addPerson() {

							var isValid = $("#form-info").valid();

							if (isValid) {
								if (editUid) {
									var docData = getForm();
									$('#add-person').html(
										'Saving... <div class="pg-spinner" style="margin-right:7px;"></div> ');
									$('#add-person').addClass('btn-saving');
									db.collection("contacts").doc(editUid).set(docData).then(() => {
										console.log("Document successfully written!");
										setTimeout(function () {
											window.location.href = '../'
										}, 600);
										$('#add-person').html('Saved! <i class="pg-icon">tick_circle</i>		');
										$('#add-person').removeClass('btn-saving');
										$('#add-person').addClass('btn-saved');
									});
								}
								// db.collection("contacts").doc().set(getForm());
							} else {
								$('body').pgNotification({
									style: 'bar',
									message: 'Some required fields are not entered ðŸ™Š',
									timeout: 3000,
									type: 'danger',
									position: 'top'
								}).show();
							}

						}


						function getForm() {

							newPersonInfo = {
								firstName: $('input[name="firstName"]').val(),
								lastName: $('input[name="lastName"]').val(),
								email: $('input[name="email"]').val(),
								phone: $('input[name="phone"]').val() || '',
								location: $('input[name="location"]').val() || '',
								// status: $('#status-select').select2('data')[0].text,
								jobTitle: $('input[name="jobTitle"]').val() || '',
								// company: $('input[name="company"]').val() || '',
								isCompany: isCompany || false,
								skills: getSelect2TextasArray($("#skills-select")) || [],
								workedOn: getSelect2TextasArray($("#prior-work-select")) || [],
								notes: $('#notes').val() || '',
								profileImageUrl: profileImageUrl || '',
								website: addHttp($('input[name="website"]').val()) || '',
								linkedin: addHttp($('input[name="linkedin"]').val()) || '',
								instagram: addHttp($('input[name="instagram"]').val()) || '',
								featuredWork: featuredWork,
								rate: $('input[name="hrRate"]').val().replace("â‚¬", "").replace("---", "") || '',
								dayRate: $('input[name="dayRate"]').val().replace("â‚¬", "").replace("---", "") || '',
								rating: parseInt($('#rating').val(), 10) || 0,
								editedAt: firebase.firestore.Timestamp.fromDate(new Date()),
								approvedStatus: 'approved',
							}

							console.log(newPersonInfo);
							return newPersonInfo;
						}

						function loadPerson() {
							const uid = getUrlParameter('id');
							console.log('param: ' + uid);
							editUid = uid;

							var userdoc = db.collection("contacts").doc(uid).get().then((doc) => {
								console.log(doc.data());

								firstName = doc.data().firstName;
								lastName = doc.data().lastName;

								$('input[name="firstName"]').val(doc.data().firstName);
								$('input[name="lastName"]').val(doc.data().lastName);
								$('#add-person').html('Save ' + doc.data().firstName + ' ' + doc.data().lastName);

								$('input[name="email"]').val(doc.data().email);
								$('input[name="phone"]').val(doc.data().phone);
								$('input[name="location"]').val(doc.data().location);
								$('input[name="email"]').val(doc.data().email);

								if (doc.data().profileImageUrl) {
									profileImageUrl = doc.data().profileImageUrl;
									$('#profile-pic-image').attr('src', profileImageUrl);
								}
								if (doc.data().jobTitle)
									$('input[name="jobTitle"]').val(doc.data().jobTitle);

								// $('input[name="company"]').val(doc.data().company);

								if (doc.data().notes)
									$('#notes').val(doc.data().notes);

								if (doc.data().skills)
									$("#skills-select").val(doc.data().skills).trigger("change");

								if (doc.data().workedOn)
									$("#prior-work-select").val(doc.data().workedOn).trigger("change");

								if (doc.data().rate) {
									$('input[name="hrRate"]').val('â‚¬' + doc.data().rate);
									$("#hrRateSlider").data("ionRangeSlider").update({
										from: doc.data().rate,
									});
								} else {
									$('input[name="hrRate"]').val('---');
								}
								if (doc.data().dayRate) {
									$('input[name="dayRate"]').val('â‚¬' + doc.data().dayRate);
									$("#dayRateSlider").data("ionRangeSlider").update({
										from: doc.data().dayRate,
									});
								} else {
									$('input[name="dayRate"]').val('---');
								}

								if (doc.data().rating) {
									$('#rating').barrating('set', doc.data().rating);
								}

								$('input[name="website"]').val(doc.data().website);
								$('input[name="linkedin"]').val(doc.data().linkedin);
								$('input[name="instagram"]').val(doc.data().instagram);


								if (doc.data().isCompany == true) {
									isCompany = true;
									$('#companyInput').prop('required', true);
									$('.avatar-wrapper #profile-pic-image').addClass('company');
									$('#jobTitle-text').text('Company type');
									$('#title-text').text('Edit company')
									$('#personRow').addClass('hideMe');
									$('#personRow').hide();
									$('#companyRow').show();
									$('#companyRow').removeClass('hideMe');
									$('input[name="company"]').val(doc.data().firstName);
								} else {
									isCompany = false;

									$('#companyInput').prop('required', false);
									$('.avatar-wrapper #profile-pic-image').removeClass('company');
									$('#jobTitle-text').text('Job Title');
									$('#title-text').text('Edit Person')
									$('#companyRow').addClass('hideMe');
									$('#companyRow').hide();
									$('#personRow').show();
									$('#personRow').removeClass('hideMe');
								}

								if (doc.data().featuredWork.length > 0) {
									$('#currentWorkImages').show();

									$.each(doc.data().featuredWork, function (key, value) {
										featuredWork.push(value);
										$('#currentWorkImages').append(
											'<div class="currentWorkImage" style="background-image:url(' +
											value + ')"><div class="delete-work" data-url="' + value +
											'"><i class="fas fa-trash-alt"></i></div></div>');
									});

									$('.delete-work').click(function () {
										featuredWork.splice(featuredWork.indexOf($(this).attr('data-url')), 1);
										$(this).parent().remove();
									});

								} else {
									$('#currentWorkImages').hide();
								}

								makeWorkScroll();
								$('#editPersonRow').addClass('loaded').removeClass('hideMe');

								updateAddButton();

							}).catch((error) => {
								console.log("Error getting document:", error);
							});


						}
						loadPerson();

						function addHttp(urlString) {
							var regexp = /(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/
							if (regexp.test(urlString)) {
								return urlString
							} else {
								if (urlString.startsWith("www")) {
									return 'https://' + urlString
								} else {
									return urlString
								}
							}
						}


						function isUrl(s) {
							var regexp = /(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/
							return regexp.test(s);
						}

						function getSelect2TextasArray(select2Object) {

							var data = select2Object.select2('data');
							var textArray = [];

							$.each(data, function (key, value) {
								textArray.push(value.text)
							});

							return textArray
						}

						function uploadProfilePhoto(file, fileName) {

							var storageRef = firebase.storage().ref();
							var uploadTask = storageRef.child('contactProfileImages/' + fileName).putString(file, 'data_url');

							uploadTask.on('state_changed',
								(snapshot) => {
									// Observe state change events such as progress, pause, and resume
									// Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded
									var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
									console.log('Upload is ' + progress + '% done');
									switch (snapshot.state) {
										case firebase.storage.TaskState.PAUSED: // or 'paused'
											console.log('Upload is paused');
											break;
										case firebase.storage.TaskState.RUNNING: // or 'running'
											console.log('Upload is running');
											break;
									}
								},
								(error) => {
									// Handle unsuccessful uploads
									console.log(error);
								},
								() => {
									// Handle successful uploads on complete
									// For instance, get the download URL: https://firebasestorage.googleapis.com/...
									uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
										console.log('File available at', downloadURL);
										profileImageUrl = downloadURL;
									});
								}
							);

						} // END uploadProfilePhoto

						//////////////////////// HELPERS /////////////////////////

						$('#sidebar-modal-shade').on('click', function () {
							$('[data-toggle="sidebar"]').trigger("click");
							$('#sidebar-modal-shade').removeClass('show');
						});

						$('.toggle-sidebar').on('click', function () {
							if ($('.page-sidebar').hasClass('visible')) {
								$('#sidebar-modal-shade').removeClass('show');
							} else {
								$('#sidebar-modal-shade').addClass('show');
							}
						});

						//////////////////////////////////////////

						var myDropzone = new Dropzone("#workDropzone", { // Make the whole body a dropzone
							url: '/',
							addRemoveLinks: true,
							method: 'put',
							chunking: true,
							forceChunking: true,
							autoQueue: false,
							autoProcessQueue: false
						});

						myDropzone.autoDiscover = false;

						myDropzone.on("addedfile", function (file) {
							console.log('FILE ADDED');
							var reader = new FileReader();
							if (myDropzone.files.length < 10) {
								reader.onload = function (event) {
									storage_upload(event.target.result, file, myDropzone);
								};
								reader.readAsDataURL(file);
							} else {
								console.log('skipping file as we are excceding the upload limit')
							}
						});

						myDropzone.on("removedfile", function (file) {
							var storageRef = firebase.storage().ref("/");
							featuredWork.splice(featuredWork.indexOf(file.fullURL), 1);
							storageRef.child(file.fullPath).delete().then(
								function () {
									console.log(file.fullPath + " - deleted successfully")
								}).catch(function (error) {
								console.log("Something is wrong")
								console.log(error)
							});
						});

						function storage_upload(filedata, filehandle, DropzoneHandle) {

							var storageRef = firebase.storage().ref();
							var uploadTask = storageRef.child('workImages/' + filehandle.name).putString(filedata, 'data_url');
							var progressBar = $(filehandle.previewElement).find(".dzprogress");

							progressBar.css("opacity", 1);
							progressBar.show();

							uploadTask.on('state_changed',
								(snapshot) => {
									// Observe state change events such as progress, pause, and resume
									var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
									progressBar.css("width", progress + '%');
								},
								(error) => {
									// Handle unsuccessful uploads
									console.log(error);
								},
								() => {
									// Handle successful uploads on complete
									uploadTask.snapshot.ref.getMetadata().then(function (meta) {
										uploadTask.snapshot.ref.getDownloadURL().then(function (downloadUrl) {
											// storing meta data and download url in object and returning
											var response = {
												object_info: {
													publicURL: downloadUrl,
													metainfo: meta
												},
												// type_of_object: type
											}
											filehandle.fullPath = meta.fullPath;
											filehandle.fullURL = downloadUrl;
											featuredWork.push(filehandle.fullURL);
											// console.log(response);
											// return cb(response)
										})
									})
									// Hiding progress bar for current file
									progressBar.css("opacity", 0);
									progressBar.hide();

								}
							);

						}

					});


					var getUrlParameter = function getUrlParameter(sParam) {
						var sPageURL = window.location.search.substring(1),
							sURLVariables = sPageURL.split('&'),
							sParameterName,
							i;

						for (i = 0; i < sURLVariables.length; i++) {
							sParameterName = sURLVariables[i].split('=');

							if (sParameterName[0] === sParam) {
								return typeof sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
							}
						}
						return false;
					};


					function makeWorkScroll() {
						const ele = document.getElementById('currentWorkImages');
						ele.style.cursor = 'grab';

						let pos = {
							top: 0,
							left: 0,
							x: 0,
							y: 0
						};

						const mouseDownHandler = function (e) {
							ele.style.cursor = 'grabbing';
							ele.style.userSelect = 'none';

							pos = {
								left: ele.scrollLeft,
								top: ele.scrollTop,
								// Get the current mouse position
								x: e.clientX,
								y: e.clientY,
							};

							document.addEventListener('mousemove', mouseMoveHandler);
							document.addEventListener('mouseup', mouseUpHandler);
						};

						const mouseMoveHandler = function (e) {
							// How far the mouse has been moved
							const dx = e.clientX - pos.x;
							const dy = e.clientY - pos.y;

							// Scroll the element
							ele.scrollTop = pos.top - dy;
							ele.scrollLeft = pos.left - dx;
						};

						const mouseUpHandler = function () {
							ele.style.cursor = 'grab';
							ele.style.removeProperty('user-select');

							document.removeEventListener('mousemove', mouseMoveHandler);
							document.removeEventListener('mouseup', mouseUpHandler);
						};

						// Attach the handler
						ele.addEventListener('mousedown', mouseDownHandler);
					}
				</script>
				<!-- END PAGE LEVEL JS -->
</body>

</html>